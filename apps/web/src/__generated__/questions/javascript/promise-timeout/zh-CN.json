{
  "description": "var Component=(()=>{var p=Object.create;var s=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var f=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty;var x=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),j=(n,e)=>{for(var o in e)s(n,o,{get:e[o],enumerable:!0})},c=(n,e,o,i)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let r of u(e))!h.call(n,r)&&r!==o&&s(n,r,{get:()=>e[r],enumerable:!(i=d(e,r))||i.enumerable});return n};var g=(n,e,o)=>(o=n!=null?p(f(n)):{},c(e||!n||!n.__esModule?s(o,\"default\",{value:n,enumerable:!0}):o,n)),_=n=>c(s({},\"__esModule\",{value:!0}),n);var a=x((k,m)=>{m.exports=_jsx_runtime});var y={};j(y,{default:()=>w,frontmatter:()=>F});var t=g(a()),F={title:\"Promise \\u8D85\\u65F6\",excerpt:\"\\u5B9E\\u73B0\\u4E00\\u4E2A\\u51FD\\u6570\\uFF0C\\u5982\\u679C promise \\u5728\\u8D85\\u65F6\\u671F\\u9650\\u5185\\u88AB fulfilled\\uFF0C\\u5219\\u89E3\\u6790\\u8BE5 promise\\uFF0C\\u5426\\u5219\\u62D2\\u7EDD\\u3002\"};function l(n){let e=Object.assign({p:\"p\",code:\"code\",pre:\"pre\"},n.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.p,{children:\"\\u5728\\u83B7\\u53D6\\u6570\\u636E\\u6216\\u6267\\u884C\\u5176\\u4ED6\\u5F02\\u6B65\\u64CD\\u4F5C\\u65F6\\uFF0C\\u6709\\u65F6\\u8BBE\\u7F6E\\u8D85\\u65F6\\u6301\\u7EED\\u65F6\\u95F4\\u5F88\\u6709\\u7528\\uFF0C\\u5373\\u5F3A\\u5236\\u5728\\u8D85\\u65F6\\u4E4B\\u524D\\u6536\\u5230\\u54CD\\u5E94\\uFF0C\\u5426\\u5219\\u5C06\\u8BF7\\u6C42\\u89C6\\u4E3A\\u5931\\u8D25\\u3002\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"\\u5B9E\\u73B0\\u4E00\\u4E2A \",(0,t.jsx)(e.code,{children:\"promiseTimeout\"}),\" \\u51FD\\u6570\\uFF0C\\u8BE5\\u51FD\\u6570\\u63A5\\u53D7\\u4E00\\u4E2A promise \\u548C\\u4E00\\u4E2A\\u8D85\\u65F6\\u6301\\u7EED\\u65F6\\u95F4\\uFF08\\u4EE5\\u6BEB\\u79D2\\u4E3A\\u5355\\u4F4D\\uFF09\\uFF0C\\u5E76\\u8FD4\\u56DE\\u4E00\\u4E2A \",(0,t.jsx)(e.code,{children:\"Promise\"}),\"\\u3002\\u5982\\u679C promise \\u53C2\\u6570\\u5728\\u8D85\\u65F6\\u671F\\u9650\\u5185\\u88AB settled\\uFF0C\\u5219\\u8FD4\\u56DE\\u7684 promise \\u5C06\\u4F7F\\u7528 promise \\u53C2\\u6570\\u7684 settled \\u503C\\u8FDB\\u884C settled\\uFF0C\\u8BE5\\u503C\\u53EF\\u4EE5\\u662F\\u5DF2\\u89E3\\u6790/\\u5DF2\\u62D2\\u7EDD\\u7684\\u503C\\u3002\\u5426\\u5219\\uFF0C\\u8FD4\\u56DE\\u7684 promise \\u5C06\\u88AB\\u62D2\\u7EDD\\uFF0C\\u5E76\\u663E\\u793A\\u5B57\\u7B26\\u4E32\\u201CPromise timeout\\u201D\\u3002\"]}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:\"language-js\",children:`function fakeFetch(latency) {\n  return new Promise((resolve, reject) => {\n    // \\u6A21\\u62DF\\u4E00\\u4E2A\\u5728 \\`latency\\` \\u4E4B\\u540E\\u89E3\\u6790\\u7684\\u5F02\\u6B65\\u64CD\\u4F5C\\u3002\n    setTimeout(() => {\n      resolve('\\u6570\\u636E\\u83B7\\u53D6\\u6210\\u529F\\uFF01');\n    }, latency);\n  });\n}\n\nconst response = await promiseTimeout(fakeFetch(1000), 2000);\nconsole.log(response); // \\u6570\\u636E\\u83B7\\u53D6\\u6210\\u529F\\uFF01\n\nawait promiseTimeout(fakeFetch(5000), 2000);\n// \\u629B\\u51FA\\u201CPromise timeout\\u201D\\u3002\n`})})]})}function P(n={}){let{wrapper:e}=n.components||{};return e?(0,t.jsx)(e,Object.assign({},n,{children:(0,t.jsx)(l,n)})):l(n)}var w=P;return _(y);})();\n;return Component;",
  "files": {
    "/package.json": "{\n  \"name\": \"@gfe-questions/promise-timeout\",\n  \"version\": \"0.0.1\",\n  \"main\": \"/src/promise-timeout.ts\",\n  \"devDependencies\": {\n    \"@types/jest\": \"29.5.0\",\n    \"typescript\": \"5.0.2\"\n  }\n}\n",
    "/tsconfig.json": "{\n  \"include\": [\"./**/*\"],\n  \"compilerOptions\": {\n    \"strict\": true,\n    \"esModuleInterop\": true,\n    \"lib\": [\"dom\", \"dom.iterable\", \"esnext\"],\n    \"jsx\": \"react-jsx\",\n    \"target\": \"es2020\"\n  }\n}\n",
    "/src/promise-timeout.run.test.ts": "import promiseTimeout from './promise-timeout';\n\ndescribe('promiseTimeout', () => {\n  test('returns a promise', () => {\n    const promise = promiseTimeout(Promise.resolve(1), 100);\n    expect(promise).toBeInstanceOf(Promise);\n  });\n\n  test('resolves before timeout', async () => {\n    const promise = promiseTimeout(\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(42);\n        }, 50);\n      }),\n      100,\n    );\n    await expect(promise).resolves.toBe(42);\n  });\n\n  test('timeout', async () => {\n    const promise = promiseTimeout(\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve(42);\n        }, 200);\n      }),\n      100,\n    );\n    await expect(promise).rejects.toBe('Promise timeout');\n  });\n});\n",
    "/src/promise-timeout.submit.test.ts": "import promiseTimeout from './promise-timeout';\n\ndescribe('promiseTimeout', () => {\n  test('returns a promise', () => {\n    const promise = promiseTimeout(Promise.resolve(1), 100);\n    expect(promise).toBeInstanceOf(Promise);\n  });\n\n  describe('settled', () => {\n    describe('resolved', () => {\n      test('immediately', async () => {\n        const promise = promiseTimeout(Promise.resolve(42), 100);\n        await expect(promise).resolves.toBe(42);\n      });\n\n      test('next tick', async () => {\n        const promise = promiseTimeout(\n          new Promise((resolve) => {\n            setTimeout(() => {\n              resolve(42);\n            }, 0);\n          }),\n          100,\n        );\n        await expect(promise).resolves.toBe(42);\n      });\n\n      test('before timeout', async () => {\n        const promise = promiseTimeout(\n          new Promise((resolve) => {\n            setTimeout(() => {\n              resolve(42);\n            }, 50);\n          }),\n          100,\n        );\n        await expect(promise).resolves.toBe(42);\n      });\n    });\n\n    describe('rejected', () => {\n      test('immediately', async () => {\n        const promise = promiseTimeout(Promise.reject(42), 100);\n        await expect(promise).rejects.toBe(42);\n      });\n\n      test('next tick', async () => {\n        const promise = promiseTimeout(\n          new Promise((_, reject) => {\n            setTimeout(() => {\n              reject(42);\n            }, 0);\n          }),\n          100,\n        );\n        await expect(promise).rejects.toBe(42);\n      });\n\n      test('before timeout', async () => {\n        const promise = promiseTimeout(\n          new Promise((_, reject) => {\n            setTimeout(() => {\n              reject(42);\n            }, 50);\n          }),\n          100,\n        );\n        await expect(promise).rejects.toBe(42);\n      });\n    });\n  });\n\n  describe('timeout', () => {\n    test('immediate', async () => {\n      const promise = promiseTimeout(\n        new Promise((resolve) => {\n          setTimeout(() => {\n            resolve(42);\n          }, 500);\n        }),\n        0,\n      );\n\n      await expect(promise).rejects.toBe('Promise timeout');\n    });\n\n    test('all immediate', async () => {\n      const promise = promiseTimeout(\n        new Promise((resolve) => {\n          setTimeout(() => {\n            resolve(42);\n          }, 0);\n        }),\n        0,\n      );\n      await expect(promise).resolves.toBe(42);\n    });\n\n    test('non-immediate', async () => {\n      const promise = promiseTimeout(\n        new Promise((resolve) => {\n          setTimeout(() => {\n            resolve(42);\n          }, 200);\n        }),\n        100,\n      );\n      await expect(promise).rejects.toBe('Promise timeout');\n    });\n  });\n});\n",
    "/src/promise-timeout.ts": "export default function promiseTimeout<T>(\n  promise: Promise<T>,\n  duration: number,\n): Promise<T> {\n  return new Promise((resolve, reject) => {\n    const timeoutId = setTimeout(() => {\n      reject('Promise timeout');\n    }, duration);\n\n    promise\n      .then(resolve)\n      .catch(reject)\n      .finally(() => {\n        clearTimeout(timeoutId);\n      });\n  });\n}\n"
  },
  "info": {
    "excerpt": "实现一个函数，如果 promise 在超时期限内被 fulfilled，则解析该 promise，否则拒绝。",
    "title": "Promise 超时"
  },
  "metadata": {
    "access": "premium",
    "author": null,
    "companies": [],
    "created": 1689552000,
    "difficulty": "medium",
    "duration": 15,
    "featured": false,
    "format": "javascript",
    "frameworkDefault": null,
    "frameworks": [],
    "href": "/questions/javascript/promise-timeout",
    "importance": "low",
    "languages": [
      "js",
      "ts"
    ],
    "nextQuestions": [],
    "published": true,
    "ranking": 100,
    "similarQuestions": [],
    "slug": "promise-timeout",
    "subtitle": null,
    "topics": [
      "async"
    ]
  },
  "skeleton": {
    "js": "/**\n * @template T\n * @param {Promise<T>} promise\n * @param {number} duration\n * @return {Promise<T>}\n */\nexport default function promiseTimeout(promise, duration) {\n  throw 'Not implemented';\n}",
    "ts": "export default function promiseTimeout<T>(\n  promise: Promise<T>,\n  duration: number,\n): Promise<T> {\n  throw 'Not implemented';\n}"
  },
  "solution": "var Component=(()=>{var P=Object.create;var n=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var f=Object.getOwnPropertyNames;var x=Object.getPrototypeOf,_=Object.prototype.hasOwnProperty;var g=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),b=(o,e)=>{for(var i in e)n(o,i,{get:e[i],enumerable:!0})},s=(o,e,i,c)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let t of f(e))!_.call(o,t)&&t!==i&&n(o,t,{get:()=>e[t],enumerable:!(c=j(e,t))||c.enumerable});return o};var v=(o,e,i)=>(i=o!=null?P(x(o)):{},s(e||!o||!o.__esModule?n(i,\"default\",{value:o,enumerable:!0}):i,o)),w=o=>s(n({},\"__esModule\",{value:!0}),o);var l=g((F,d)=>{d.exports=_jsx_runtime});var k={};b(k,{default:()=>X});var r=v(l());var m=MDXCodeBlock;var u=`/**\n * @template T\n * @param {Promise<T>} promise\n * @param {number} duration\n * @return {Promise<T>}\n */\nexport default function promiseTimeout(promise, duration) {\n  return new Promise((resolve, reject) => {\n    const timeoutId = setTimeout(() => {\n      reject('Promise timeout');\n    }, duration);\n\n    promise\n      .then(resolve)\n      .catch(reject)\n      .finally(() => {\n        clearTimeout(timeoutId);\n      });\n  });\n}\n`;var a=`export default function promiseTimeout<T>(\n  promise: Promise<T>,\n  duration: number,\n): Promise<T> {\n  return new Promise((resolve, reject) => {\n    const timeoutId = setTimeout(() => {\n      reject('Promise timeout');\n    }, duration);\n\n    promise\n      .then(resolve)\n      .catch(reject)\n      .finally(() => {\n        clearTimeout(timeoutId);\n      });\n  });\n}\n`;var h=`/**\n * @template T\n * @param {Promise<T>} promise\n * @param {number} duration\n * @return {Promise<T>}\n */\nexport default function promiseTimeout(promise, duration) {\n  const timeout = new Promise((_, reject) => {\n    setTimeout(() => {\n      reject('Promise timeout');\n    }, duration);\n  });\n\n  return Promise.race([promise, timeout]);\n}\n`;var p=`export default function promiseTimeout<T>(\n  promise: Promise<T>,\n  duration: number,\n): Promise<T> {\n  const timeout = new Promise((_, reject) => {\n    setTimeout(() => {\n      reject('Promise timeout');\n    }, duration);\n  });\n\n  return Promise.race([promise, timeout]) as Promise<T>;\n}\n`;function T(o){let e=Object.assign({h2:\"h2\",ol:\"ol\",li:\"li\",code:\"code\",h3:\"h3\",p:\"p\",ul:\"ul\"},o.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h2,{children:\"\\u89E3\\u51B3\\u65B9\\u6848\"}),`\n`,(0,r.jsxs)(e.ol,{children:[`\n`,(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:\"promiseTimeout\"}),\" \\u51FD\\u6570\\u63A5\\u53D7\\u4E24\\u4E2A\\u53C2\\u6570\\uFF1A\\u539F\\u59CB\\u7684 \",(0,r.jsx)(e.code,{children:\"promise\"}),\" \\u548C\\u4EE5\\u6BEB\\u79D2\\u4E3A\\u5355\\u4F4D\\u7684\\u8D85\\u65F6 \",(0,r.jsx)(e.code,{children:\"duration\"}),\"\\u3002\"]}),`\n`,(0,r.jsxs)(e.li,{children:[\"\\u5728\\u51FD\\u6570\\u5185\\u90E8\\uFF0C\\u521B\\u5EFA\\u4E00\\u4E2A\\u65B0\\u7684 \",(0,r.jsx)(e.code,{children:\"Promise\"}),\" \\u5E76\\u8FD4\\u56DE\\uFF0C\\u8BE5 \",(0,r.jsx)(e.code,{children:\"Promise\"}),\" \\u5C06\\u5728\\u6307\\u5B9A\\u7684 \",(0,r.jsx)(e.code,{children:\"duration\"}),\" \\u4E4B\\u540E\\u4F7F\\u7528\\u81EA\\u5B9A\\u4E49\\u9519\\u8BEF \",(0,r.jsx)(e.code,{children:\"reject()\"}),\"\\u3002\"]}),`\n`,(0,r.jsxs)(e.li,{children:[\"\\u5982\\u679C\\u5728 \",(0,r.jsx)(e.code,{children:\"duration\"}),\" \\u7ED3\\u675F\\u4E4B\\u524D\\u6EE1\\u8DB3 \",(0,r.jsx)(e.code,{children:\"promise\"}),\" \\u53C2\\u6570\\uFF0C\\u6211\\u4EEC\\u53EF\\u4EE5\\u4F7F\\u7528\\u5DF2\\u6EE1\\u8DB3\\u7684\\u503C \",(0,r.jsx)(e.code,{children:\"resolve()\"}),\" \\u8BE5 promise\\u3002\\u5982\\u679C\\u5B83\\u88AB\\u62D2\\u7EDD\\uFF0C\\u6211\\u4EEC\\u53EF\\u4EE5\\u4F7F\\u7528\\u88AB\\u62D2\\u7EDD\\u7684\\u539F\\u56E0 \",(0,r.jsx)(e.code,{children:\"reject()\"}),\"\\u3002\"]}),`\n`,(0,r.jsxs)(e.li,{children:[\"\\u6211\\u4EEC\\u4F7F\\u7528 \",(0,r.jsx)(e.code,{children:\"setTimeout\"}),\" \\u6765\\u8BBE\\u7F6E\\u8D85\\u65F6\\u673A\\u5236\\u3002\\u5F53\\u8FBE\\u5230\\u8D85\\u65F6\\u65F6\\u95F4\\u65F6\\uFF0C\\u8FD4\\u56DE\\u7684 promise \\u5C06\\u4F7F\\u7528\\u81EA\\u5B9A\\u4E49\\u9519\\u8BEF\\u6D88\\u606F \",(0,r.jsx)(e.code,{children:\"reject()\"}),\"\\u3002\"]}),`\n`,(0,r.jsxs)(e.li,{children:[\"\\u5982\\u679C promise \\u5728\\u8D85\\u65F6\\u4E4B\\u524D\\u88AB\\u89E3\\u51B3\\uFF0C\\u6211\\u4EEC\\u5E94\\u8BE5\\u6E05\\u9664\\u8BA1\\u65F6\\u5668\\u3002\\u6211\\u4EEC\\u53EF\\u4EE5\\u4FDD\\u7559\\u4ECE \",(0,r.jsx)(e.code,{children:\"setTimeout\"}),\" \\u8FD4\\u56DE\\u7684 id \\u7684\\u5F15\\u7528\\uFF0C\\u5E76\\u5728 \",(0,r.jsx)(e.code,{children:\".finally()\"}),\" \\u65B9\\u6CD5\\u4E2D\\u4F7F\\u7528 \",(0,r.jsx)(e.code,{children:\"clearTimeout\"}),\" \\u6E05\\u9664\\u8D85\\u65F6\\uFF0C\\u8FD9\\u6837\\u8D85\\u65F6\\u5185\\u7684 \",(0,r.jsx)(e.code,{children:\"reject()\"}),\" \\u5C31\\u4E0D\\u4F1A\\u88AB\\u4E0D\\u5FC5\\u8981\\u5730\\u8C03\\u7528\\u3002\"]}),`\n`]}),`\n`,(0,r.jsx)(m,{languages:{jsx:u,tsx:a}}),`\n`,(0,r.jsxs)(e.h3,{children:[\"\\u4F7F\\u7528 \",(0,r.jsx)(e.code,{children:\"Promise.race()\"})]}),`\n`,(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:\"setTimeout\"}),\" \\u4E5F\\u662F\\u4E00\\u4E2A\\u5F02\\u6B65\\u64CD\\u4F5C\\uFF0C\\u56E0\\u6B64\\u88AB\\u5305\\u88C5\\u5728\\u4E00\\u4E2A \",(0,r.jsx)(e.code,{children:\"Promise\"}),\" \\u4E2D\\u3002\\u6211\\u4EEC\\u53EF\\u4EE5\\u901A\\u8FC7\\u4F7F\\u7528 \",(0,r.jsx)(e.code,{children:\"Promise.race()\"}),\" \\u6765\\u7B80\\u5316\\u6267\\u884C\\u903B\\u8F91\\uFF1B\\u9996\\u5148\\u89E3\\u51B3\\u7684\\u4EFB\\u4F55 promise \\u90FD\\u5C06\\u51B3\\u5B9A\\u8FD4\\u56DE\\u7684 \",(0,r.jsx)(e.code,{children:\"Promise\"}),\" \\u7684\\u7ED3\\u679C\\u3002\"]}),`\n`,(0,r.jsx)(m,{languages:{jsx:h,tsx:p}}),`\n`,(0,r.jsx)(e.h2,{children:\"\\u8FB9\\u7F18\\u60C5\\u51B5\"}),`\n`,(0,r.jsxs)(e.ul,{children:[`\n`,(0,r.jsxs)(e.li,{children:[\"\\u5982\\u679C \",(0,r.jsx)(e.code,{children:\"promise\"}),\" \\u53C2\\u6570\\u7ACB\\u5373\\u89E3\\u6790\\uFF0C\\u5219\\u603B\\u7ED3\\u679C\\u5E94\\u88AB\\u89E3\\u6790\\uFF0C\\u800C\\u4E0E\\u8D85\\u65F6\\u6301\\u7EED\\u65F6\\u95F4\\u65E0\\u5173\\uFF0C\\u5373\\u4F7F\\u4E3A 0\\u3002\"]}),`\n`]})]})}function I(o={}){let{wrapper:e}=o.components||{};return e?(0,r.jsx)(e,Object.assign({},o,{children:(0,r.jsx)(T,o)})):T(o)}var X=I;return w(k);})();\n;return Component;",
  "workspace": {
    "main": "/src/promise-timeout.ts",
    "run": "/src/promise-timeout.run.test.ts",
    "submit": "/src/promise-timeout.submit.test.ts"
  }
}
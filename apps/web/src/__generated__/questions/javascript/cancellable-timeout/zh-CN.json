{
  "description": "var Component=(()=>{var m=Object.create;var c=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,b=Object.prototype.hasOwnProperty;var T=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),C=(n,e)=>{for(var l in e)c(n,l,{get:e[l],enumerable:!0})},r=(n,e,l,o)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let t of h(e))!b.call(n,t)&&t!==l&&c(n,t,{get:()=>e[t],enumerable:!(o=u(e,t))||o.enumerable});return n};var x=(n,e,l)=>(l=n!=null?m(p(n)):{},r(e||!n||!n.__esModule?c(l,\"default\",{value:n,enumerable:!0}):l,n)),g=n=>r(c({},\"__esModule\",{value:!0}),n);var i=T((N,s)=>{s.exports=_jsx_runtime});var k={};C(k,{default:()=>f,frontmatter:()=>j});var a=x(i()),j={title:\"\\u53EF\\u53D6\\u6D88\\u7684\\u8D85\\u65F6\",excerpt:\"\\u5B9E\\u73B0\\u4E00\\u4E2A\\u7C7B\\u4F3C\\u4E8E setTimeout \\u7684\\u51FD\\u6570\\uFF0C\\u4F46\\u8FD4\\u56DE\\u4E00\\u4E2A\\u7528\\u4E8E\\u53D6\\u6D88\\u5F85\\u5904\\u7406\\u56DE\\u8C03\\u7684\\u51FD\\u6570\"};function d(n){let e=Object.assign({p:\"p\",code:\"code\",pre:\"pre\",a:\"a\",h2:\"h2\"},n.components);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(e.p,{children:[\"\\u5B9E\\u73B0\\u4E00\\u4E2A\\u51FD\\u6570 \",(0,a.jsx)(e.code,{children:\"setCancellableTimeout\"}),\"\\uFF0C\\u5B83\\u7684\\u884C\\u4E3A\\u7C7B\\u4F3C\\u4E8E \",(0,a.jsx)(e.code,{children:\"setTimeout\"}),\"\\uFF0C\\u4F46\\u5B83\\u4E0D\\u8FD4\\u56DE\\u8BA1\\u65F6\\u5668 ID\\uFF0C\\u800C\\u662F\\u8FD4\\u56DE\\u4E00\\u4E2A\\u51FD\\u6570\\uFF0C\\u5F53\\u8C03\\u7528\\u8BE5\\u51FD\\u6570\\u65F6\\uFF0C\\u4F1A\\u53D6\\u6D88\\u5F85\\u5904\\u7406\\u7684\\u56DE\\u8C03\\u51FD\\u6570\\u3002 \",(0,a.jsx)(e.code,{children:\"setCancellableTimeout\"}),\" \\u51FD\\u6570\\u7684\\u7B7E\\u540D\\u5E94\\u4E0E \",(0,a.jsx)(e.code,{children:\"setTimeout\"}),\" \\u5B8C\\u5168\\u76F8\\u540C\\uFF1A\"]}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:\"language-js\",children:`setCancellableTimeout(callback);\nsetCancellableTimeout(callback, delay);\nsetCancellableTimeout(callback, delay, param1);\nsetCancellableTimeout(callback, delay, param1, param2);\nsetCancellableTimeout(callback, delay, param1, param2, /* \\u2026 ,*/ paramN);\n`})}),`\n`,(0,a.jsxs)(e.p,{children:[\"\\u5982\\u679C\\u60A8\\u4E0D\\u719F\\u6089 \",(0,a.jsx)(e.code,{children:\"setTimeout\"}),\"\\uFF0C\\u5EFA\\u8BAE\\u60A8\\u9605\\u8BFB \",(0,a.jsx)(e.a,{href:\"https://developer.mozilla.org/zh-CN/docs/Web/API/setTimeout\",children:\"MDN \\u6587\\u6863\"}),\"\\u3002\"]}),`\n`,(0,a.jsx)(e.h2,{children:\"\\u4F8B\\u5B50\"}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:\"language-js\",children:`let i = 0;\n// t = 0:\nconst cancel = setCancellableTimeout(() => {\n  i++;\n}, 100);\n// t = 50:\ncancel();\n// t = 100: i \\u4ECD\\u7136\\u662F 0\\uFF0C\\u56E0\\u4E3A\\u8C03\\u7528\\u4E86 cancel()\\u3002\n`})})]})}function _(n={}){let{wrapper:e}=n.components||{};return e?(0,a.jsx)(e,Object.assign({},n,{children:(0,a.jsx)(d,n)})):d(n)}var f=_;return g(k);})();\n;return Component;",
  "files": {
    "/package.json": "{\n  \"name\": \"@gfe-questions/cancellable-timeout\",\n  \"version\": \"0.0.1\",\n  \"main\": \"/src/cancellable-timeout.ts\",\n  \"devDependencies\": {\n    \"@types/jest\": \"29.5.0\",\n    \"typescript\": \"5.0.2\"\n  }\n}\n",
    "/tsconfig.json": "{\n  \"include\": [\"./**/*\"],\n  \"compilerOptions\": {\n    \"strict\": true,\n    \"esModuleInterop\": true,\n    \"lib\": [\"dom\", \"dom.iterable\", \"esnext\"],\n    \"jsx\": \"react-jsx\",\n    \"target\": \"es2020\"\n  }\n}\n",
    "/src/cancellable-timeout.run.test.ts": "import setCancellableTimeout from './cancellable-timeout';\n\ndescribe('setCancellableTimeout', () => {\n  test('returns a function', () => {\n    expect(typeof setCancellableTimeout(() => {})).toBe('function');\n  });\n\n  test('cancelled immediately', (done) => {\n    expect.assertions(2);\n    let i = 0;\n\n    setTimeout(() => {\n      // Ensure setTimeout callback is never called.\n      expect(i).toBe(0);\n      done();\n    });\n    const cancel = setCancellableTimeout(() => {\n      i++;\n    }, 10);\n    cancel();\n    expect(i).toBe(0);\n  });\n\n  test('not cancelled', (done) => {\n    expect.assertions(2);\n    let i = 0;\n\n    setCancellableTimeout(() => {\n      i++;\n      expect(i).toBe(1);\n      done();\n    }, 100);\n\n    expect(i).toBe(0);\n  });\n});\n",
    "/src/cancellable-timeout.submit.test.ts": "import setCancellableTimeout from './cancellable-timeout';\n\ndescribe('setCancellableTimeout', () => {\n  test('returns a function', () => {\n    expect(typeof setCancellableTimeout(() => {})).toBe('function');\n  });\n\n  describe('cancelled', () => {\n    test('immediately', (done) => {\n      expect.assertions(2);\n      let i = 0;\n\n      setTimeout(() => {\n        // Ensure setTimeout callback is never called.\n        expect(i).toBe(0);\n        done();\n      });\n      const cancel = setCancellableTimeout(() => {\n        i++;\n      }, 10);\n      cancel();\n      expect(i).toBe(0);\n    });\n\n    test('delayed', (done) => {\n      expect.assertions(2);\n      let i = 0;\n\n      setTimeout(() => {\n        // Ensure setTimeout callback is never called.\n        expect(i).toBe(0);\n        done();\n      }, 20);\n      const cancel = setCancellableTimeout(() => {\n        i++;\n      }, 10);\n      cancel();\n      expect(i).toBe(0);\n    });\n  });\n\n  describe('not cancelled', () => {\n    test('immediately', (done) => {\n      expect.assertions(2);\n      let i = 0;\n\n      setCancellableTimeout(() => {\n        i++;\n        expect(i).toBe(1);\n        done();\n      });\n\n      expect(i).toBe(0);\n    });\n\n    test('delayed', (done) => {\n      expect.assertions(2);\n      let i = 0;\n\n      setCancellableTimeout(() => {\n        i++;\n        expect(i).toBe(1);\n        done();\n      }, 100);\n\n      expect(i).toBe(0);\n    });\n\n    test('uses parameters', (done) => {\n      expect.assertions(2);\n      let i = 1;\n\n      setCancellableTimeout(\n        (foo: number, bar: number) => {\n          i += foo;\n          i *= bar;\n          expect(i).toBe(21);\n          done();\n        },\n        10,\n        2,\n        7,\n      );\n\n      expect(i).toBe(1);\n    });\n\n    test('cancelling afterwards is safe', (done) => {\n      expect.assertions(3);\n      let i = 1;\n\n      const cancel = setCancellableTimeout(\n        (foo: number, bar: number) => {\n          i += foo;\n          i *= bar;\n          expect(i).toBe(21);\n        },\n        10,\n        2,\n        7,\n      );\n\n      setTimeout(() => {\n        cancel();\n        expect(i).toBe(21);\n        done();\n      }, 50);\n\n      expect(i).toBe(1);\n    });\n  });\n\n  test('callbacks can access `this`', (done) => {\n    expect.assertions(2);\n\n    function increment(this: any, delta: number) {\n      this.val += delta;\n    }\n\n    const obj = {\n      val: 13,\n    };\n\n    setCancellableTimeout(increment.bind(obj), 10, 15);\n\n    expect(obj.val).toBe(13);\n\n    setTimeout(() => {\n      expect(obj.val).toBe(28);\n      done();\n    }, 20);\n  });\n});\n",
    "/src/cancellable-timeout.ts": "export default function setCancellableTimeout(\n  callback: Function,\n  delay?: number,\n  ...args: Array<any>\n): () => void {\n  const timerId = setTimeout(callback, delay, ...args);\n\n  return () => {\n    clearTimeout(timerId);\n  };\n}\n"
  },
  "info": {
    "excerpt": "实现一个类似于 setTimeout 的函数，但返回一个用于取消待处理回调的函数",
    "title": "可取消的超时"
  },
  "metadata": {
    "access": "premium",
    "author": null,
    "companies": [],
    "created": 1689552000,
    "difficulty": "easy",
    "duration": 10,
    "featured": false,
    "format": "javascript",
    "frameworkDefault": null,
    "frameworks": [],
    "href": "/questions/javascript/cancellable-timeout",
    "importance": "low",
    "languages": [
      "js",
      "ts"
    ],
    "nextQuestions": [],
    "published": true,
    "ranking": 100,
    "similarQuestions": [
      "cancellable-interval"
    ],
    "slug": "cancellable-timeout",
    "subtitle": null,
    "topics": [
      "async"
    ]
  },
  "skeleton": {
    "js": "/**\n * @param {Function} callback\n * @param {number} delay\n * @param {...any} args\n * @returns {Function}\n */\nexport default function setCancellableTimeout(callback, delay, ...args) {\n  throw 'Not implemented';\n}",
    "ts": "export default function setCancellableTimeout(\n  callback: Function,\n  delay?: number,\n  ...args: Array<any>\n): () => void {\n  throw 'Not implemented';\n}"
  },
  "solution": "var Component=(()=>{var T=Object.create;var t=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var y=Object.getPrototypeOf,x=Object.prototype.hasOwnProperty;var k=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),I=(r,e)=>{for(var l in e)t(r,l,{get:e[l],enumerable:!0})},i=(r,e,l,o)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let n of g(e))!x.call(r,n)&&n!==l&&t(r,n,{get:()=>e[n],enumerable:!(o=f(e,n))||o.enumerable});return r};var F=(r,e,l)=>(l=r!=null?T(y(r)):{},i(e||!r||!r.__esModule?t(l,\"default\",{value:r,enumerable:!0}):l,r)),_=r=>i(t({},\"__esModule\",{value:!0}),r);var m=k((S,d)=>{d.exports=_jsx_runtime});var X={};I(X,{default:()=>v});var c=F(m());var a=MDXCodeBlock;var u=`/**\n * @param {Function} callback\n * @param {number} delay\n * @param {...any} args\n * @returns {Function}\n */\nexport default function setCancellableTimeout(callback, delay, ...args) {\n  const timerId = setTimeout(callback, delay, ...args);\n\n  return () => {\n    clearTimeout(timerId);\n  };\n}\n`;var s=`export default function setCancellableTimeout(\n  callback: Function,\n  delay?: number,\n  ...args: Array<any>\n): () => void {\n  const timerId = setTimeout(callback, delay, ...args);\n\n  return () => {\n    clearTimeout(timerId);\n  };\n}\n`;var h=`/**\n * @param {Function} callback\n * @param {number} delay\n * @param {...any} args\n * @returns {Function}\n */\nexport default function setCancellableTimeout(...args) {\n  const timerId = setTimeout(...args);\n\n  return () => {\n    clearTimeout(timerId);\n  };\n}\n`;var p=`/**\n * @param {Function} callback\n * @param {number} delay\n * @param {...any} args\n * @returns {Function}\n */\nexport default function setCancellableTimeout(callback, delay, ...args) {\n  let cancelled = false;\n  setTimeout(() => {\n    if (cancelled) {\n      return;\n    }\n\n    callback(...args);\n  }, delay);\n\n  return () => {\n    cancelled = true;\n  };\n}\n`;function b(r){let e=Object.assign({h2:\"h2\",p:\"p\",code:\"code\",h3:\"h3\",a:\"a\",ul:\"ul\",li:\"li\"},r.components);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(e.h2,{children:\"\\u89E3\\u51B3\\u65B9\\u6848\"}),`\n`,(0,c.jsxs)(e.p,{children:[\"\\u8FD4\\u56DE\\u53D6\\u6D88\\u51FD\\u6570\\u800C\\u4E0D\\u662F \",(0,c.jsx)(e.code,{children:\"timerId\"}),\" \\u7684\\u597D\\u5904\\u662F\\u5EF6\\u8FDF\\u673A\\u5236\\u88AB\\u62BD\\u8C61\\u51FA\\u6765\\uFF0C\\u53EF\\u4EE5\\u88AB\\u66FF\\u6362\\u6210\\u5176\\u4ED6\\u4E1C\\u897F\\u3002\\u4F46\\u5B9E\\u9645\\u4E0A\\uFF0C\\u5728 JavaScript \\u4E2D\\u6CA1\\u6709\\u5176\\u4ED6\\u65B9\\u6CD5\\u53EF\\u4EE5\\u5B9E\\u73B0\\u5EF6\\u8FDF\\u6267\\u884C\\uFF0C\\u8FD9\\u5C31\\u662F\\u4E3A\\u4EC0\\u4E48\\u4F60\\u53EF\\u80FD\\u5728\\u9762\\u8BD5\\u4E4B\\u5916\\u770B\\u4E0D\\u5230\\u5B83\\u7684\\u539F\\u56E0\\u3002\"]}),`\n`,(0,c.jsxs)(e.h3,{children:[\"\\u65B9\\u6CD5 1\\uFF1A\\u8FD4\\u56DE\\u4E00\\u4E2A\\u8C03\\u7528 \",(0,c.jsx)(e.code,{children:\"clearTimeout\"}),\" \\u7684\\u51FD\\u6570\"]}),`\n`,(0,c.jsxs)(e.p,{children:[(0,c.jsx)(e.code,{children:\"setTimeout\"}),\" \\u8FD4\\u56DE\\u4E00\\u4E2A\\u8BA1\\u65F6\\u5668 ID\\u3002\\u8981\\u53D6\\u6D88\\u8BA1\\u65F6\\u5668\\uFF0C\\u6211\\u4EEC\\u53EF\\u4EE5\\u8C03\\u7528 \",(0,c.jsx)(e.code,{children:\"clearTimeout(timerId)\"}),\"\\u3002\\u89E3\\u51B3\\u8FD9\\u4E2A\\u95EE\\u9898\\u7684\\u4E00\\u4E2A\\u7B80\\u5355\\u65B9\\u6CD5\\u662F\\u8FD4\\u56DE\\u4E00\\u4E2A\\u5B8C\\u5168\\u76F8\\u540C\\u7684\\u51FD\\u6570\\u3002\\u6211\\u4EEC\\u53EF\\u4EE5\\u5C06\\u6240\\u6709\\u53C2\\u6570\\u8F6C\\u53D1\\u7ED9 \",(0,c.jsx)(e.code,{children:\"setTimeout\"}),\"\\u3002\"]}),`\n`,(0,c.jsx)(a,{languages:{jsx:u,tsx:s}}),`\n`,(0,c.jsxs)(e.p,{children:[\"\\u6211\\u4EEC\\u53EF\\u4EE5\\u7A0D\\u5FAE\\u7B80\\u5316\\u4EE3\\u7801\\uFF0C\\u5E76\\u5C06\\u6240\\u6709\\u53C2\\u6570\\u8F6C\\u53D1\\u7ED9 \",(0,c.jsx)(e.code,{children:\"setTimeout\"}),\"\\u3002\"]}),`\n`,(0,c.jsx)(a,{children:h}),`\n`,(0,c.jsxs)(e.p,{children:[\"\\u6211\\u4EEC\\u4E0D\\u5FC5\\u62C5\\u5FC3\\u56DE\\u8C03\\u51FD\\u6570\\u4E2D\\u7684 \",(0,c.jsx)(e.code,{children:\"this\"}),\"\\uFF0C\\u56E0\\u4E3A\\u6CA1\\u6709\\u9009\\u9879\\u53EF\\u4EE5\\u5C06 \",(0,c.jsx)(e.code,{children:\"thisArg\"}),\" \\u4F20\\u9012\\u7ED9 \",(0,c.jsx)(e.code,{children:\"setTimeout\"}),\"\\uFF0C\\u8FD9\\u4E0E \",(0,c.jsx)(e.code,{children:\"Array.prototype.forEach()\"}),\"/\",(0,c.jsx)(e.code,{children:\"Array.prototype.reduce()\"}),\" \\u4E0D\\u540C\\u3002\\u9605\\u8BFB\\u66F4\\u591A\\u5173\\u4E8E \",(0,c.jsx)(e.a,{href:\"https://developer.mozilla.org/en-US/docs/Web/API/setTimeout#the_this_problem\",children:\"MDN \\u4E0A\\u7684 this\"}),\"\\u3002\"]}),`\n`,(0,c.jsxs)(e.h3,{children:[\"\\u65B9\\u6CD5 2\\uFF1A\\u7EF4\\u62A4\\u4E00\\u4E2A \",(0,c.jsx)(e.code,{children:\"cancelled\"}),\" \\u6807\\u5FD7\\uFF08\\u975E\\u6700\\u4F73\\uFF09\"]}),`\n`,(0,c.jsxs)(e.p,{children:[\"\\u53E6\\u4E00\\u79CD\\u65B9\\u6CD5\\u662F\\u7EF4\\u62A4\\u4E00\\u4E2A \",(0,c.jsx)(e.code,{children:\"cancelled\"}),\" \\u6807\\u5FD7\\uFF0C\\u5F53\\u8C03\\u7528\\u8FD4\\u56DE\\u7684\\u51FD\\u6570\\u65F6\\uFF0C\\u8BE5\\u6807\\u5FD7\\u5C06\\u8BBE\\u7F6E\\u4E3A \",(0,c.jsx)(e.code,{children:\"true\"}),\"\\u3002\\u5728\\u8C03\\u7528 \",(0,c.jsx)(e.code,{children:\"setTimeout\"}),\" \\u56DE\\u8C03\\u4E4B\\u524D\\uFF0C\\u68C0\\u67E5 \",(0,c.jsx)(e.code,{children:\"cancelled\"}),\" \\u7684\\u503C\\uFF0C\\u7136\\u540E\\u518D\\u6267\\u884C \",(0,c.jsx)(e.code,{children:\"callback\"}),\"\\u3002\\u8FD9\\u5E76\\u975E\\u6700\\u4F73\\uFF0C\\u56E0\\u4E3A \",(0,c.jsx)(e.code,{children:\"setTimeout\"}),\" \\u56DE\\u8C03\\u4ECD\\u7136\\u88AB\\u4E0D\\u5FC5\\u8981\\u5730\\u8C03\\u7528\\uFF0C\\u6700\\u7EC8\\u4EC0\\u4E48\\u4E5F\\u6CA1\\u505A\\u3002\"]}),`\n`,(0,c.jsx)(a,{children:p}),`\n`,(0,c.jsx)(e.h2,{children:\"\\u8D44\\u6E90\"}),`\n`,(0,c.jsxs)(e.ul,{children:[`\n`,(0,c.jsx)(e.li,{children:(0,c.jsxs)(e.a,{href:\"https://developer.mozilla.org/en-US/docs/Web/API/setTimeout\",children:[(0,c.jsx)(e.code,{children:\"setTimeout()\"}),\" | MDN\"]})}),`\n`]})]})}function M(r={}){let{wrapper:e}=r.components||{};return e?(0,c.jsx)(e,Object.assign({},r,{children:(0,c.jsx)(b,r)})):b(r)}var v=M;return _(X);})();\n;return Component;",
  "workspace": {
    "main": "/src/cancellable-timeout.ts",
    "run": "/src/cancellable-timeout.run.test.ts",
    "submit": "/src/cancellable-timeout.submit.test.ts"
  }
}
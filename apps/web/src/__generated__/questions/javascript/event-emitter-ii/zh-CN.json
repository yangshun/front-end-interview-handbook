{
  "description": "var Component=(()=>{var a=Object.create;var c=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var f=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var b=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),v=(t,e)=>{for(var r in e)c(t,r,{get:e[r],enumerable:!0})},h=(t,e,r,i)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let d of f(e))!u.call(t,d)&&d!==r&&c(t,d,{get:()=>e[d],enumerable:!(i=m(e,d))||i.enumerable});return t};var g=(t,e,r)=>(r=t!=null?a(p(t)):{},h(e||!t||!t.__esModule?c(r,\"default\",{value:t,enumerable:!0}):r,t)),E=t=>h(c({},\"__esModule\",{value:!0}),t);var o=b((_,l)=>{l.exports=_jsx_runtime});var w={};v(w,{default:()=>N,frontmatter:()=>j});var n=g(o()),j={title:\"\\u4E8B\\u4EF6\\u53D1\\u5C04\\u5668 II\",excerpt:\"\\u5B9E\\u73B0\\u4E00\\u4E2A\\u53EF\\u4EE5\\u8BA2\\u9605\\u548C\\u53D1\\u51FA\\u4E8B\\u4EF6\\u7684\\u7C7B\\uFF0C\\u8FD9\\u4E9B\\u4E8B\\u4EF6\\u4F1A\\u89E6\\u53D1\\u9644\\u52A0\\u7684\\u56DE\\u8C03\\u51FD\\u6570\\u3002\\u8FD4\\u56DE\\u8BA2\\u9605\\u5BF9\\u8C61\\uFF0C\\u5E76\\u4E14\\u53EF\\u4EE5\\u53D6\\u6D88\\u8BA2\\u9605\\u3002\"};function s(t){let e=Object.assign({p:\"p\",a:\"a\",strong:\"strong\",code:\"code\",h2:\"h2\",h3:\"h3\",table:\"table\",thead:\"thead\",tr:\"tr\",th:\"th\",tbody:\"tbody\",td:\"td\",pre:\"pre\"},t.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.p,{children:[\"\\u5728 \",(0,n.jsx)(e.a,{href:\"https://www.patterns.dev/posts/observer-pattern/\",children:(0,n.jsx)(e.strong,{children:\"\\u89C2\\u5BDF\\u8005\\u6A21\\u5F0F\"})}),\"\\uFF08\\u4E5F\\u5E38\\u88AB\\u79F0\\u4E3A\\u53D1\\u5E03-\\u8BA2\\u9605\\u6A21\\u578B\\uFF09\\u4E2D\\uFF0C\\u6211\\u4EEC\\u53EF\\u4EE5\\u89C2\\u5BDF/\\u8BA2\\u9605\\u7531\\u53D1\\u5E03\\u8005\\u53D1\\u51FA\\u7684\\u4E8B\\u4EF6\\uFF0C\\u5E76\\u5728\\u4E8B\\u4EF6\\u53D1\\u751F\\u65F6\\u6267\\u884C\\u4EE3\\u7801\\u3002\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u5B9E\\u73B0\\u4E00\\u4E2A\\u7C7B\\u4F3C\\u4E8E \",(0,n.jsx)(e.a,{href:\"https://nodejs.org/api/events.html\",children:\"Node.js\"}),\" \\u4E2D\\u7684 \",(0,n.jsxs)(e.a,{href:\"https://nodejs.org/api/events.html#class-eventemitter\",children:[(0,n.jsx)(e.code,{children:\"EventEmitter\"}),\" \\u7C7B\"]}),\"\\uFF0C\\u5B83\\u9075\\u5FAA\\u8FD9\\u6837\\u7684\\u89C2\\u5BDF\\u8005\\u6A21\\u5F0F\\u3002\\u8FD9\\u4E2A\\u95EE\\u9898\\u548C\\u7B2C\\u4E00\\u4E2A \",(0,n.jsx)(e.a,{href:\"/questions/javascript/event-emitter\",children:\"\\u4E8B\\u4EF6\\u53D1\\u5C04\\u5668\"}),\" \\u95EE\\u9898\\u7684\\u533A\\u522B\\u5728\\u4E8E\\u53D6\\u6D88\\u8BA2\\u9605\\u76D1\\u542C\\u5668\\u7684\\u65B9\\u5F0F\\u3002\\u5728\\u8FD9\\u4E2A\\u7248\\u672C\\u4E2D\\uFF0C\",(0,n.jsx)(e.code,{children:\"EventEmitter\"}),\" \\u5B9E\\u4F8B\\u4E0A\\u6CA1\\u6709 \",(0,n.jsx)(e.code,{children:\"emitter.off()\"}),\" \\u65B9\\u6CD5\\u3002\\u76F8\\u53CD\\uFF0C\",(0,n.jsx)(e.code,{children:\"emitter.on()\"}),\" \\u8FD4\\u56DE\\u4E00\\u4E2A\\u5177\\u6709 \",(0,n.jsx)(e.code,{children:\"off()\"}),\" \\u65B9\\u6CD5\\u7684\\u5BF9\\u8C61\\u3002\"]}),`\n`,(0,n.jsxs)(e.h2,{children:[(0,n.jsx)(e.code,{children:\"EventEmitter\"}),\" API\"]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u5B9E\\u73B0\\u4EE5\\u4E0B\\u7C7B\\u548C API\\uFF1A\"}),`\n`,(0,n.jsx)(e.h3,{children:(0,n.jsx)(e.code,{children:\"new EventEmitter()\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u521B\\u5EFA\\u4E00\\u4E2A \",(0,n.jsx)(e.code,{children:\"EventEmitter\"}),\" \\u7C7B\\u7684\\u5B9E\\u4F8B\\u3002\\u4E8B\\u4EF6\\u548C\\u76D1\\u542C\\u5668\\u5728\\u5B83\\u4EEC\\u88AB\\u6DFB\\u52A0\\u5230\\u7684 \",(0,n.jsx)(e.code,{children:\"EventEmitter\"}),\" \\u5B9E\\u4F8B\\u4E2D\\u662F\\u9694\\u79BB\\u7684\\uFF0C\\u4E5F\\u5C31\\u662F\\u8BF4\\uFF0C\\u76D1\\u542C\\u5668\\u4E0D\\u5E94\\u8BE5\\u5BF9\\u5176\\u4ED6 \",(0,n.jsx)(e.code,{children:\"EventEmitter\"}),\" \\u5B9E\\u4F8B\\u53D1\\u51FA\\u7684\\u4E8B\\u4EF6\\u505A\\u51FA\\u53CD\\u5E94\\u3002\"]}),`\n`,(0,n.jsx)(e.h3,{children:(0,n.jsx)(e.code,{children:\"emitter.on(eventName, listener)\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u6DFB\\u52A0\\u4E00\\u4E2A\\u56DE\\u8C03\\u51FD\\u6570 (\",(0,n.jsx)(e.code,{children:\"listener\"}),\")\\uFF0C\\u5F53\\u53D1\\u51FA\\u540D\\u4E3A \",(0,n.jsx)(e.code,{children:\"eventName\"}),\" \\u7684\\u4E8B\\u4EF6\\u65F6\\uFF0C\\u5C06\\u8C03\\u7528\\u8BE5\\u51FD\\u6570\\u3002\"]}),`\n`,(0,n.jsxs)(e.table,{children:[(0,n.jsx)(e.thead,{children:(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.th,{children:\"\\u53C2\\u6570\"}),(0,n.jsx)(e.th,{children:\"\\u7C7B\\u578B\"}),(0,n.jsx)(e.th,{children:\"\\u63CF\\u8FF0\"})]})}),(0,n.jsxs)(e.tbody,{children:[(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:(0,n.jsx)(e.code,{children:\"eventName\"})}),(0,n.jsx)(e.td,{children:(0,n.jsx)(e.code,{children:\"string\"})}),(0,n.jsx)(e.td,{children:\"\\u4E8B\\u4EF6\\u7684\\u540D\\u79F0\\u3002\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:(0,n.jsx)(e.code,{children:\"listener\"})}),(0,n.jsx)(e.td,{children:(0,n.jsx)(e.code,{children:\"Function\"})}),(0,n.jsx)(e.td,{children:\"\\u53D1\\u751F\\u4E8B\\u4EF6\\u65F6\\u8981\\u8C03\\u7528\\u7684\\u56DE\\u8C03\\u51FD\\u6570\\u3002\"})]})]})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u8FD4\\u56DE\\u4E00\\u4E2A\\u8BA2\\u9605\\u5BF9\\u8C61\\uFF0C\\u8BE5\\u5BF9\\u8C61\\u5177\\u6709\\u4E00\\u4E2A \",(0,n.jsx)(e.code,{children:\"off()\"}),\" \\u65B9\\u6CD5\\uFF0C\\u8BE5\\u65B9\\u6CD5\\u5C06\\u6B64\\u76D1\\u542C\\u5668\\u4ECE\\u4E8B\\u4EF6\\u4E2D\\u53D6\\u6D88\\u8BA2\\u9605\\u3002\\u66F4\\u591A\\u7EC6\\u8282\\u5982\\u4E0B\\u3002\"]}),`\n`,(0,n.jsx)(e.h3,{children:(0,n.jsx)(e.code,{children:\"emitter.emit(eventName[, ...args])\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u6309\\u987A\\u5E8F\\u8C03\\u7528\\u6BCF\\u4E2A\\u76D1\\u542C \",(0,n.jsx)(e.code,{children:\"eventName\"}),\" \\u7684\\u76D1\\u542C\\u5668\\uFF0C\\u5E76\\u63D0\\u4F9B\\u63D0\\u4F9B\\u7684\\u53C2\\u6570\\u3002\"]}),`\n`,(0,n.jsxs)(e.table,{children:[(0,n.jsx)(e.thead,{children:(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.th,{children:\"\\u53C2\\u6570\"}),(0,n.jsx)(e.th,{children:\"\\u7C7B\\u578B\"}),(0,n.jsx)(e.th,{children:\"\\u63CF\\u8FF0\"})]})}),(0,n.jsxs)(e.tbody,{children:[(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:(0,n.jsx)(e.code,{children:\"eventName\"})}),(0,n.jsx)(e.td,{children:(0,n.jsx)(e.code,{children:\"string\"})}),(0,n.jsx)(e.td,{children:\"\\u4E8B\\u4EF6\\u7684\\u540D\\u79F0\\u3002\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:(0,n.jsx)(e.code,{children:\"...args\"})}),(0,n.jsx)(e.td,{children:(0,n.jsx)(e.code,{children:\"any\"})}),(0,n.jsx)(e.td,{children:\"\\u7528\\u4E8E\\u8C03\\u7528\\u76D1\\u542C\\u5668\\u51FD\\u6570\\u5217\\u8868\\u7684\\u53C2\\u6570\\u3002\"})]})]})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u5982\\u679C\\u4E8B\\u4EF6\\u6709\\u76D1\\u542C\\u5668\\uFF0C\\u5219\\u8FD4\\u56DE \",(0,n.jsx)(e.code,{children:\"true\"}),\"\\uFF0C\\u5426\\u5219\\u8FD4\\u56DE \",(0,n.jsx)(e.code,{children:\"false\"}),\"\\u3002\"]}),`\n`,(0,n.jsx)(e.h3,{children:(0,n.jsx)(e.code,{children:\"sub.off()\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u6B64\\u5BF9\\u8C61\\u4ECE \",(0,n.jsx)(e.code,{children:\"emitter.on()\"}),\" \\u8FD4\\u56DE\\u3002\\u8C03\\u7528 \",(0,n.jsx)(e.code,{children:\"sub.off()\"}),\" \\u5C06\\u76F8\\u5E94\\u7684\\u76D1\\u542C\\u5668\\u4ECE\\u4E8B\\u4EF6\\u4E2D\\u53D6\\u6D88\\u8BA2\\u9605\\u3002\"]}),`\n`,(0,n.jsx)(e.h2,{children:\"\\u4F8B\\u5B50\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-js\",children:`const emitter = new EventEmitter();\n\nfunction addTwoNumbers(a, b) {\n  console.log(\\`The sum is \\${a + b}\\`);\n}\n\n// \\u8FD4\\u56DE\\u4E00\\u4E2A\\u5177\\u6709 .off() \\u65B9\\u6CD5\\u7684\\u8BA2\\u9605\\u5BF9\\u8C61\\u3002\nconst sub = emitter.on('foo', addTwoNumbers);\nemitter.emit('foo', 2, 5);\n// > \"The sum is 7\"\n\nemitter.on('foo', (a, b) => {\n  console.log(\\`The product is \\${a * b}\\`);\n});\nemitter.emit('foo', 4, 5);\n// > \"The sum is 9\"\n// > \"The product is 20\"\n\nsub.off(); // \\u8FD9\\u5C06\\u53D6\\u6D88\\u8BA2\\u9605\\u8BB0\\u5F55\\u6570\\u5B57\\u603B\\u548C\\u7684\\u56DE\\u8C03\\u3002\nemitter.emit('foo', -3, 9);\n// > \"The product is -27\"\n// (\\u53EA\\u89E6\\u53D1\\u4E58\\u6CD5\\u56DE\\u8C03\\uFF0C\\u7B2C\\u4E00\\u4E2A\\u88AB\\u53D6\\u6D88\\u8BA2\\u9605\\u3002)\n`})})]})}function x(t={}){let{wrapper:e}=t.components||{};return e?(0,n.jsx)(e,Object.assign({},t,{children:(0,n.jsx)(s,t)})):s(t)}var N=x;return E(w);})();\n;return Component;",
  "files": {
    "/package.json": "{\n  \"name\": \"@gfe-questions/event-emitter-ii\",\n  \"version\": \"0.0.1\",\n  \"main\": \"/src/event-emitter-ii.ts\",\n  \"devDependencies\": {\n    \"@types/jest\": \"29.5.0\",\n    \"typescript\": \"5.0.2\"\n  }\n}\n",
    "/tsconfig.json": "{\n  \"include\": [\"./**/*\"],\n  \"compilerOptions\": {\n    \"strict\": true,\n    \"esModuleInterop\": true,\n    \"lib\": [\"dom\", \"dom.iterable\", \"esnext\"],\n    \"jsx\": \"react-jsx\",\n    \"target\": \"es2020\"\n  }\n}\n",
    "/src/event-emitter-ii.run.test.ts": "import EventEmitter from './event-emitter-ii';\n\ndescribe('EventEmitter', () => {\n  test('constructor', () => {\n    const emitter = new EventEmitter();\n    expect(emitter).toBeInstanceOf(EventEmitter);\n  });\n\n  test('emit', () => {\n    const emitter = new EventEmitter();\n    let a = 0;\n    emitter.on('foo', () => {\n      a = 1;\n    });\n    emitter.emit('foo');\n\n    expect(a).toBe(1);\n  });\n\n  test('unsubscribe', () => {\n    const emitter = new EventEmitter();\n\n    let sum = 0;\n    function addTwoNumbers(a: number, b: number) {\n      sum = a + b;\n    }\n    const sub = emitter.on('foo', addTwoNumbers);\n    emitter.emit('foo', 2, 5);\n    expect(sum).toBe(7);\n\n    sub.off();\n    emitter.emit('foo', -3, 9);\n    expect(sum).toBe(7);\n  });\n});\n",
    "/src/event-emitter-ii.submit.test.ts": "import EventEmitter from './event-emitter-ii';\n\ndescribe('EventEmitter', () => {\n  test('constructor', () => {\n    const emitter = new EventEmitter();\n    expect(emitter).toBeInstanceOf(EventEmitter);\n  });\n\n  describe('subscribe', () => {\n    test('returns object with off() method', () => {\n      const emitter = new EventEmitter();\n      const sub = emitter.on('foo', () => {});\n\n      expect(sub).toBeTruthy();\n      expect(sub.off).toBeTruthy();\n    });\n\n    test('single listener', () => {\n      const emitter = new EventEmitter();\n      let a = 0;\n      emitter.on('foo', () => {\n        a = 1;\n      });\n      emitter.emit('foo');\n\n      expect(a).toBe(1);\n    });\n\n    test('multiple listeners', () => {\n      const emitter = new EventEmitter();\n      let a = 0,\n        b = 1;\n      emitter.on('foo', () => {\n        a = 1;\n      });\n      emitter.on('foo', () => {\n        b = 3;\n      });\n      emitter.emit('foo');\n\n      expect(a).toBe(1);\n      expect(b).toBe(3);\n    });\n\n    test('multiple events', () => {\n      const emitter = new EventEmitter();\n      let a = 0,\n        b = 1;\n      emitter.on('foo', () => {\n        a = 1;\n      });\n      emitter.on('bar', () => {\n        b = 3;\n      });\n      emitter.emit('foo');\n      expect(a).toBe(1);\n      expect(b).toBe(1);\n\n      emitter.emit('bar');\n      expect(b).toBe(3);\n    });\n\n    test('same listener added multiple times', () => {\n      const emitter = new EventEmitter();\n\n      let num = 1;\n      function square() {\n        num *= 2;\n      }\n\n      emitter.on('square', square);\n      emitter.emit('square');\n      expect(num).toBe(2);\n\n      emitter.on('square', square);\n      emitter.emit('square');\n      expect(num).toBe(8);\n    });\n  });\n\n  describe('emit', () => {\n    describe('listeners are invoked with arguments', () => {\n      test('single argument', () => {\n        const emitter = new EventEmitter();\n\n        let sum = 0;\n        emitter.on('foo', (a: number) => {\n          sum = a;\n        });\n        emitter.emit('foo', 3);\n        expect(sum).toBe(3);\n\n        emitter.emit('foo', 5);\n        expect(sum).toBe(5);\n      });\n\n      test('two arguments', () => {\n        const emitter = new EventEmitter();\n\n        let sum = 0;\n        emitter.on('foo', (a: number, b: number) => {\n          sum = a + b;\n        });\n        emitter.emit('foo', 3, 5);\n        expect(sum).toBe(8);\n\n        emitter.emit('foo', 4, 13);\n        expect(sum).toBe(17);\n      });\n\n      test('multiple arguments', () => {\n        const emitter = new EventEmitter();\n\n        let product = 0;\n        emitter.on('foo', (a: number, b: number, c: number) => {\n          product = a * b * c;\n        });\n        emitter.emit('foo', 3, 5, 6);\n        expect(product).toBe(90);\n\n        emitter.emit('foo', 4, 13, 9);\n        expect(product).toBe(468);\n      });\n    });\n\n    describe('non-existing event name returns false', () => {\n      test('custom event', () => {\n        const emitter = new EventEmitter();\n\n        expect(emitter.emit('foo')).toBe(false);\n      });\n\n      test('same name as built-in event', () => {\n        const emitter = new EventEmitter();\n\n        expect(emitter.emit('toString')).toBe(false);\n      });\n    });\n  });\n\n  describe('unsubscribe', () => {\n    test('single listener', () => {\n      const emitter = new EventEmitter();\n\n      let sum = 0;\n      function addTwoNumbers(a: number, b: number) {\n        sum = a + b;\n      }\n      const sub = emitter.on('foo', addTwoNumbers);\n      emitter.emit('foo', 2, 5);\n      expect(sum).toBe(7);\n\n      sub.off();\n      emitter.emit('foo', -3, 9);\n      expect(sum).toBe(7);\n    });\n\n    test('multiple listeners', () => {\n      const emitter = new EventEmitter();\n\n      let sum = 0;\n      function addTwoNumbers(a: number, b: number) {\n        sum = a + b;\n      }\n      const addSub = emitter.on('foo', addTwoNumbers);\n      emitter.emit('foo', 2, 5);\n      expect(sum).toBe(7);\n\n      let product = 0;\n      function multiplyTwoNumbers(a: number, b: number) {\n        product = a * b;\n      }\n      const mulSub = emitter.on('foo', multiplyTwoNumbers);\n      emitter.emit('foo', 4, 5);\n      expect(sum).toBe(9);\n      expect(product).toBe(20);\n\n      addSub.off();\n      emitter.emit('foo', -3, 9);\n      expect(sum).toBe(9);\n      expect(product).toBe(-27);\n\n      mulSub.off();\n      emitter.emit('foo', 3, 7);\n      expect(sum).toBe(9);\n      expect(product).toBe(-27);\n    });\n\n    test('multiple events', () => {\n      const emitter = new EventEmitter();\n\n      let sum = 0;\n      function addTwoNumbers(a: number, b: number) {\n        sum = a + b;\n      }\n      const fooSub = emitter.on('foo', addTwoNumbers);\n      emitter.emit('foo', 2, 5);\n      expect(sum).toBe(7);\n\n      const barSub = emitter.on('bar', addTwoNumbers);\n      emitter.emit('bar', 3, 7);\n      expect(sum).toBe(10);\n\n      fooSub.off();\n      emitter.emit('foo', -3, 9);\n      expect(sum).toBe(10);\n\n      barSub.off();\n      emitter.emit('bar', -3, 9);\n      expect(sum).toBe(10);\n    });\n\n    test('same listener added multiple times removed correctly', () => {\n      const emitter = new EventEmitter();\n\n      let num = 1;\n      function square() {\n        num *= 2;\n      }\n\n      const sub1 = emitter.on('square', square);\n      emitter.emit('square');\n      expect(num).toBe(2);\n\n      const sub2 = emitter.on('square', square);\n      emitter.emit('square');\n      expect(num).toBe(8);\n\n      sub1.off();\n      emitter.emit('square');\n      expect(num).toBe(16);\n\n      sub2.off();\n      emitter.emit('square');\n      expect(num).toBe(16);\n    });\n\n    test(\"sub.off() called more than once doesn't crash\", () => {\n      const emitter = new EventEmitter();\n\n      let sum = 0;\n      function addTwoNumbers(a: number, b: number) {\n        sum = a + b;\n      }\n      const sub = emitter.on('foo', addTwoNumbers);\n      emitter.emit('foo', 2, 5);\n      expect(sum).toBe(7);\n\n      sub.off();\n      emitter.emit('foo', -3, 9);\n      expect(sum).toBe(7);\n\n      sub.off();\n      emitter.emit('foo', -3, 9);\n      expect(sum).toBe(7);\n    });\n  });\n});\n",
    "/src/event-emitter-ii.ts": "interface IEventEmitter {\n  on(eventName: string, listener: Function): { off: () => void };\n  emit(eventName: string, ...args: Array<any>): boolean;\n}\n\n// You are free to use alternative approaches of\n// instantiating the EventEmitter as long as the\n// default export is correct.\nexport default class EventEmitter implements IEventEmitter {\n  _key: number;\n  _events: Record<string, Record<string, Function>>;\n\n  constructor() {\n    // Avoid creating objects via `{}` to exclude unwanted properties\n    // on the prototype (such as `.toString`).\n    this._events = Object.create(null);\n    // Use an incrementing number to uniquely identify each listener.\n    this._key = 0;\n  }\n\n  on(eventName: string, listener: Function): { off: () => void } {\n    if (!Object.hasOwn(this._events, eventName)) {\n      // It's ok to use `{}` here since the keys will just be numbers.\n      this._events[eventName] = {};\n    }\n\n    const listenerId = this._key;\n    this._events[eventName][listenerId] = listener;\n    this._key++;\n\n    return {\n      // Use arrow function so that `this` is preserved.\n      off: () => {\n        delete this._events[eventName][listenerId];\n      },\n    };\n  }\n\n  emit(eventName: string, ...args: Array<any>): boolean {\n    // Return false for non-existing eventNames or events without listeners.\n    if (\n      !Object.hasOwn(this._events, eventName) ||\n      Object.keys(this._events[eventName]).length === 0\n    ) {\n      return false;\n    }\n\n    // Make a clone of the listeners in case one of the\n    // listeners calls sub.off() and changes the listeners.\n    const listeners = { ...this._events[eventName] };\n    Object.values(listeners).forEach((listener) => {\n      listener.apply(null, args);\n    });\n\n    return true;\n  }\n}\n"
  },
  "info": {
    "excerpt": "实现一个可以订阅和发出事件的类，这些事件会触发附加的回调函数。返回订阅对象，并且可以取消订阅。",
    "title": "事件发射器 II"
  },
  "metadata": {
    "access": "premium",
    "author": null,
    "companies": [
      "google",
      "lyft",
      "tiktok",
      "bytedance",
      "microsoft"
    ],
    "created": 1669939200,
    "difficulty": "medium",
    "duration": 20,
    "featured": false,
    "format": "javascript",
    "frameworkDefault": null,
    "frameworks": [],
    "href": "/questions/javascript/event-emitter-ii",
    "importance": "medium",
    "languages": [
      "js",
      "ts"
    ],
    "nextQuestions": [],
    "published": true,
    "ranking": 100,
    "similarQuestions": [
      "event-emitter",
      "jquery-class-manipulation",
      "backbone-model"
    ],
    "slug": "event-emitter-ii",
    "subtitle": null,
    "topics": [
      "oop"
    ]
  },
  "skeleton": {
    "js": "// You are free to use alternative approaches of\n// instantiating the EventEmitter as long as the\n// default export is correct.\nexport default class EventEmitter {\n  constructor() {\n    throw 'Not implemented!';\n  }\n\n  /**\n   * @param {string} eventName\n   * @param {Function} listener\n   * @returns {{off: Function}}\n   */\n  on(eventName, listener) {\n    throw 'Not implemented!';\n  }\n\n  /**\n   * @param {string} eventName\n   * @param {...any} args\n   * @returns boolean\n   */\n  emit(eventName, ...args) {\n    throw 'Not implemented!';\n  }\n}",
    "ts": "interface IEventEmitter {\n  on(eventName: string, listener: Function): { off: () => void };\n  emit(eventName: string, ...args: Array<any>): boolean;\n}\n\n// You are free to use alternative approaches of\n// instantiating the EventEmitter as long as the\n// default export is correct.\nexport default class EventEmitter implements IEventEmitter {\n  constructor() {\n    throw 'Not implemented!';\n  }\n\n  on(eventName: string, listener: Function): { off: () => void } {\n    throw 'Not implemented!';\n  }\n\n  emit(eventName: string, ...args: Array<any>): boolean {\n    throw 'Not implemented!';\n  }\n}"
  },
  "solution": "var Component=(()=>{var f=Object.create;var c=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var g=Object.getPrototypeOf,b=Object.prototype.hasOwnProperty;var y=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),_=(t,e)=>{for(var i in e)c(t,i,{get:e[i],enumerable:!0})},d=(t,e,i,s)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let r of N(e))!b.call(t,r)&&r!==i&&c(t,r,{get:()=>e[r],enumerable:!(s=p(e,r))||s.enumerable});return t};var j=(t,e,i)=>(i=t!=null?f(g(t)):{},d(e||!t||!t.__esModule?c(i,\"default\",{value:t,enumerable:!0}):i,t)),E=t=>d(c({},\"__esModule\",{value:!0}),t);var h=y((S,o)=>{o.exports=_jsx_runtime});var F={};_(F,{default:()=>w});var n=j(h());var l=MDXCodeBlock;var a=`export default class EventEmitter {\n  constructor() {\n    // Avoid creating objects via \\`{}\\` to exclude unwanted properties\n    // on the prototype (such as \\`.toString\\`).\n    this._events = Object.create(null);\n    // Use an incrementing number to uniquely identify each listener.\n    this._key = 0;\n  }\n\n  /**\n   * @param {string} eventName\n   * @param {Function} listener\n   * @returns {{off: Function}}\n   */\n  on(eventName, listener) {\n    if (!Object.hasOwn(this._events, eventName)) {\n      // It's ok to use \\`{}\\` here since the keys will just be numbers.\n      this._events[eventName] = {};\n    }\n\n    const listenerId = this._key;\n    this._events[eventName][listenerId] = listener;\n    this._key++;\n\n    return {\n      // Use arrow function so that \\`this\\` is preserved.\n      off: () => {\n        delete this._events[eventName][listenerId];\n      },\n    };\n  }\n\n  /**\n   * @param {string} eventName\n   * @param {...any} args\n   * @returns boolean\n   */\n  emit(eventName, ...args) {\n    // Early return for non-existing eventNames or\n    // events without listeners.\n    if (\n      !Object.hasOwn(this._events, eventName) ||\n      Object.keys(this._events[eventName]).length === 0\n    ) {\n      return false;\n    }\n\n    // Make a clone of the listeners in case one of the\n    // listeners calls sub.off() and changes the listeners.\n    const listeners = { ...this._events[eventName] };\n    Object.values(listeners).forEach((listener) => {\n      listener.apply(null, args);\n    });\n\n    return true;\n  }\n}\n`;var m=`interface IEventEmitter {\n  on(eventName: string, listener: Function): { off: () => void };\n  emit(eventName: string, ...args: Array<any>): boolean;\n}\n\n// You are free to use alternative approaches of\n// instantiating the EventEmitter as long as the\n// default export is correct.\nexport default class EventEmitter implements IEventEmitter {\n  _key: number;\n  _events: Record<string, Record<string, Function>>;\n\n  constructor() {\n    // Avoid creating objects via \\`{}\\` to exclude unwanted properties\n    // on the prototype (such as \\`.toString\\`).\n    this._events = Object.create(null);\n    // Use an incrementing number to uniquely identify each listener.\n    this._key = 0;\n  }\n\n  on(eventName: string, listener: Function): { off: () => void } {\n    if (!Object.hasOwn(this._events, eventName)) {\n      // It's ok to use \\`{}\\` here since the keys will just be numbers.\n      this._events[eventName] = {};\n    }\n\n    const listenerId = this._key;\n    this._events[eventName][listenerId] = listener;\n    this._key++;\n\n    return {\n      // Use arrow function so that \\`this\\` is preserved.\n      off: () => {\n        delete this._events[eventName][listenerId];\n      },\n    };\n  }\n\n  emit(eventName: string, ...args: Array<any>): boolean {\n    // Return false for non-existing eventNames or events without listeners.\n    if (\n      !Object.hasOwn(this._events, eventName) ||\n      Object.keys(this._events[eventName]).length === 0\n    ) {\n      return false;\n    }\n\n    // Make a clone of the listeners in case one of the\n    // listeners calls sub.off() and changes the listeners.\n    const listeners = { ...this._events[eventName] };\n    Object.values(listeners).forEach((listener) => {\n      listener.apply(null, args);\n    });\n\n    return true;\n  }\n}\n`;var u=`export default function EventEmitter() {\n  // Avoid creating objects via \\`{}\\` to exclude unwanted properties\n  // on the prototype (such as \\`.toString\\`).\n  this._events = Object.create(null);\n  // Use an incrementing number to unique identify each listener.\n  this._key = 0;\n}\n\n/**\n * @param {string} eventName\n * @param {Function} listener\n * @returns {{off: Function}}\n */\nEventEmitter.prototype.on = function (eventName, listener) {\n  if (!Object.hasOwn(this._events, eventName)) {\n    // It's ok to use \\`{}\\` here since the keys will just be numbers.\n    this._events[eventName] = {};\n  }\n\n  const listenerId = this._key;\n  this._events[eventName][listenerId] = listener;\n  this._key++;\n\n  return {\n    // Use arrow function so that \\`this\\` is preserved.\n    off: () => {\n      delete this._events[eventName][listenerId];\n    },\n  };\n};\n\n/**\n * @param {string} eventName\n * @param {...any} args\n * @returns boolean\n */\nEventEmitter.prototype.emit = function (eventName, ...args) {\n  // Early return for non-existing eventNames or events without listeners.\n  if (\n    !Object.hasOwn(this._events, eventName) ||\n    Object.keys(this._events[eventName]).length === 0\n  ) {\n    return false;\n  }\n\n  // Make a clone of the listeners in case one of the listeners\n  // calls sub.off() and changes the listeners.\n  const listeners = { ...this._events[eventName] };\n  Object.values(listeners).forEach((listener) => {\n    listener.apply(null, args);\n  });\n\n  return true;\n};\n`;function v(t){let e=Object.assign({p:\"p\",code:\"code\",h2:\"h2\",ol:\"ol\",li:\"li\",ul:\"ul\",h3:\"h3\",h4:\"h4\",pre:\"pre\",a:\"a\"},t.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.p,{children:[\"\\u57FA\\u4E8E\\u4E8B\\u4EF6\\u7684\\u4EA4\\u4E92\\u6A21\\u578B\\u662F\\u6784\\u5EFA\\u7528\\u6237\\u754C\\u9762\\u7684\\u6700\\u5E38\\u89C1\\u65B9\\u5F0F\\u3002DOM \\u4E5F\\u662F\\u56F4\\u7ED5\\u6B64\\u6A21\\u578B\\u6784\\u5EFA\\u7684\\uFF0C\\u4F7F\\u7528 \",(0,n.jsx)(e.code,{children:\"document.addEventListener()\"}),\" \\u548C \",(0,n.jsx)(e.code,{children:\"document.removeEventListener()\"}),\" API \\u6765\\u5141\\u8BB8\\u54CD\\u5E94 \",(0,n.jsx)(e.code,{children:\"click\"}),\"\\u3001\",(0,n.jsx)(e.code,{children:\"hover\"}),\"\\u3001\",(0,n.jsx)(e.code,{children:\"input\"}),\" \\u7B49\\u4E8B\\u4EF6\\u3002\"]}),`\n`,(0,n.jsx)(e.h2,{children:\"\\u6F84\\u6E05\\u95EE\\u9898\"}),`\n`,(0,n.jsx)(e.p,{children:\"\\u4EE5\\u4E0B\\u662F\\u5411\\u9762\\u8BD5\\u5B98\\u63D0\\u95EE\\u4EE5\\u5C55\\u793A\\u60A8\\u7684\\u5468\\u5168\\u8003\\u8651\\u7684\\u597D\\u95EE\\u9898\\u3002\\u6839\\u636E\\u4ED6\\u4EEC\\u7684\\u56DE\\u7B54\\uFF0C\\u60A8\\u53EF\\u80FD\\u9700\\u8981\\u76F8\\u5E94\\u5730\\u8C03\\u6574\\u5B9E\\u73B0\\u3002\"}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"\\u9664\\u4E86 \",(0,n.jsx)(e.code,{children:\"eventName\"}),\" \\u4E4B\\u5916\\uFF0C\\u53EF\\u4EE5\\u4E0D\\u5E26\\u4EFB\\u4F55\\u53C2\\u6570\\u8C03\\u7528 \",(0,n.jsx)(e.code,{children:\"emitter.emit()\"}),\" \\u5417\\uFF1F\",`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"\\u662F\\u7684\\uFF0C\\u53EF\\u4EE5\\u3002\"}),`\n`]}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[\"\\u53EF\\u4EE5\\u4F7F\\u7528\\u76F8\\u540C\\u7684 \",(0,n.jsx)(e.code,{children:\"eventName\"}),\" \\u591A\\u6B21\\u6DFB\\u52A0\\u76F8\\u540C\\u7684\\u76D1\\u542C\\u5668\\u5417\\uFF1F\",`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"\\u662F\\u7684\\uFF0C\\u53EF\\u4EE5\\u3002\\u5F53 \",(0,n.jsx)(e.code,{children:\"eventName\"}),\" \\u4EE5\\u6DFB\\u52A0\\u7684\\u987A\\u5E8F\\u53D1\\u51FA\\u65F6\\uFF0C\\u5B83\\u5C06\\u4E3A\\u6BCF\\u6B21\\u6DFB\\u52A0\\u8C03\\u7528\\u4E00\\u6B21\\u3002\"]}),`\n`]}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[\"\\u53EF\\u4EE5\\u53D1\\u51FA\\u4E0D\\u5B58\\u5728\\u7684\\u4E8B\\u4EF6\\u5417\\uFF1F\",`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"\\u662F\\u7684\\uFF0C\\u4F46\\u662F\\u4E0D\\u5E94\\u8BE5\\u53D1\\u751F\\u4EFB\\u4F55\\u4E8B\\u60C5\\uFF0C\\u5E76\\u4E14\\u4EE3\\u7801\\u4E0D\\u5E94\\u8BE5\\u51FA\\u9519\\u6216\\u5D29\\u6E83\\u3002\"}),`\n`]}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[\"\\u76D1\\u542C\\u5668\\u7684 \",(0,n.jsx)(e.code,{children:\"this\"}),\" \\u503C\\u5E94\\u8BE5\\u662F\\u4EC0\\u4E48\\uFF1F\",`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"\\u5B83\\u53EF\\u4EE5\\u662F \",(0,n.jsx)(e.code,{children:\"null\"}),\"\\u3002\"]}),`\n`]}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[\"\\u53EF\\u4EE5\\u591A\\u6B21\\u8C03\\u7528 \",(0,n.jsx)(e.code,{children:\"sub.off()\"}),\" \\u5417\\uFF1F\",`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"\\u662F\\u7684\\uFF0C\\u53EF\\u4EE5\\uFF0C\\u7B2C\\u4E8C\\u6B21\\u8C03\\u7528\\u5E94\\u8BE5\\u662F\\u4E00\\u4E2A\\u7A7A\\u64CD\\u4F5C\\u3002\"}),`\n`]}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[\"\\u76D1\\u542C\\u5668\\u662F\\u5426\\u53EF\\u4EE5\\u5305\\u542B\\u5728 emitter \\u5B9E\\u4F8B\\u4E0A\\u8C03\\u7528\\u65B9\\u6CD5\\u7684\\u4EE3\\u7801\\uFF1F\",`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"\\u662F\\u7684\\uFF0C\\u4F46\\u662F\\u5BF9\\u4E8E\\u8FD9\\u4E2A\\u95EE\\u9898\\uFF0C\\u6211\\u4EEC\\u53EF\\u4EE5\\u5FFD\\u7565\\u8FD9\\u79CD\\u60C5\\u51B5\\u3002\"}),`\n`]}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[\"\\u5982\\u679C\\u76D1\\u542C\\u5668\\u56DE\\u8C03\\u5728 \",(0,n.jsx)(e.code,{children:\"emitter.emit()\"}),\" \\u671F\\u95F4\\u629B\\u51FA\\u9519\\u8BEF\\u600E\\u4E48\\u529E\\uFF1F\",`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"\\u5E94\\u8BE5\\u6355\\u83B7\\u8BE5\\u9519\\u8BEF\\uFF0C\\u5E76\\u4E14\\u4E0D\\u5E94\\u505C\\u6B62\\u5176\\u4F59\\u7684\\u6267\\u884C\\u3002\\u4F46\\u662F\\uFF0C\\u6211\\u4EEC\\u4E0D\\u4F1A\\u6D4B\\u8BD5\\u8FD9\\u79CD\\u60C5\\u51B5\\u3002\"}),`\n`]}),`\n`]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u6211\\u4EEC\\u5C06\\u5904\\u7406\\u4E0A\\u8FF0\\u6240\\u6709\\u60C5\\u51B5\\uFF0C\\u9664\\u4E86\\u6700\\u540E\\u4E24\\u79CD\\u60C5\\u51B5\\u3002\"}),`\n`,(0,n.jsx)(e.h2,{children:\"\\u89E3\\u51B3\\u65B9\\u6848\"}),`\n`,(0,n.jsx)(e.h3,{children:\"\\u6570\\u636E\\u7ED3\\u6784\"}),`\n`,(0,n.jsx)(e.p,{children:\"\\u9996\\u5148\\uFF0C\\u6211\\u4EEC\\u5FC5\\u987B\\u786E\\u5B9A\\u7528\\u4E8E\\u5B58\\u50A8\\u4E8B\\u4EF6\\u548C\\u76D1\\u542C\\u5668\\u7684\\u6570\\u636E\\u7ED3\\u6784\\u3002\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u6211\\u4EEC\\u9700\\u8981\\u80FD\\u591F\\u552F\\u4E00\\u5730\\u6807\\u8BC6\\u6BCF\\u4E2A\\u76D1\\u542C\\u5668\\u51FD\\u6570\\uFF0C\\u4EE5\\u4FBF\\u5728\\u8C03\\u7528 \",(0,n.jsx)(e.code,{children:\"sub.off()\"}),\" \\u65F6\\uFF0C\\u6211\\u4EEC\\u77E5\\u9053\\u8981\\u5220\\u9664\\u54EA\\u4E2A\\u76D1\\u542C\\u5668\\u3002\\u8FD9\\u53EF\\u4EE5\\u901A\\u8FC7\\u8BA9 \",(0,n.jsx)(e.code,{children:\"EventEmitter\"}),\" \\u5B9E\\u4F8B\\u4FDD\\u7559\\u4E00\\u4E2A\\u6574\\u6570\\u8BA1\\u6570\\u5668\\u6765\\u5B9E\\u73B0\\uFF0C\\u8BE5\\u8BA1\\u6570\\u5668\\u5728\\u6DFB\\u52A0\\u6BCF\\u4E2A\\u65B0\\u76D1\\u542C\\u5668\\u65F6\\u9012\\u589E\\uFF0C\\u5E76\\u4E14\\u6BCF\\u4E2A\\u76D1\\u542C\\u5668\\u90FD\\u88AB\\u5206\\u914D\\u8BA1\\u6570\\u5668\\u7684\\u5F53\\u524D\\u503C\\u3002\"]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u6211\\u4EEC\\u53EF\\u4EE5\\u4F7F\\u7528\\uFF1A\"}),`\n`,(0,n.jsxs)(e.h4,{children:[\"1. \",(0,n.jsx)(e.code,{children:\"eventName\"}),\" \\u7684 Map\\uFF0C\\u76D1\\u542C\\u5668\\u51FD\\u6570\\u7684 Map\\u3002\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-js\",children:`events = {\n  foo: { 1: Function1, 3: Function3 },\n  bar: { 2: Function2 },\n};\n`})}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"\\u4F18\\u70B9\\uFF1A\",`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"\\u7ED9\\u5B9A \",(0,n.jsx)(e.code,{children:\"eventName\"}),\" \\u548C\\u76D1\\u542C\\u5668 ID\\uFF0C\\u53EF\\u4EE5\\u5FEB\\u901F\\u67E5\\u627E\\u76D1\\u542C\\u5668\\u3002\"]}),`\n`]}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[\"\\u7F3A\\u70B9\\uFF1A\",`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"\\u7531\\u4E8E \",(0,n.jsx)(e.code,{children:\"eventName\"}),\" \\u7531\\u7528\\u6237\\u63D0\\u4F9B\\uFF0C\\u5B83\\u53EF\\u4EE5\\u662F\\u4EFB\\u4F55\\u503C\\uFF0C\\u5E76\\u4E14\\u53EF\\u80FD\\u4E0E \",(0,n.jsx)(e.code,{children:\"Object.prototype\"}),\" \\u4E0A\\u7684\\u73B0\\u6709\\u952E\\uFF08\\u4F8B\\u5982 \",(0,n.jsx)(e.code,{children:\".toString\"}),\"\\uFF09\\u51B2\\u7A81\\u3002\\u6211\\u4EEC\\u5C06\\u5904\\u7406\\u8FD9\\u79CD\\u60C5\\u51B5\\u3002\"]}),`\n`]}),`\n`]}),`\n`]}),`\n`,(0,n.jsxs)(e.h4,{children:[\"2. \",(0,n.jsx)(e.code,{children:\"eventName\"}),\" \\u548C\\u76D1\\u542C\\u5668\\u5BF9\\u7684\\u6241\\u5E73\\u6570\\u7EC4\\u3002\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-js\",children:`events = [\n  { eventName: 'foo', listener: Function1, key: 1 },\n  { eventName: 'bar', listener: Function2, key: 2 },\n  { eventName: 'foo', listener: Function3, key: 3 },\n];\n`})}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"\\u4F18\\u70B9\\uFF1A\",`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"\\u7B80\\u5355\\u3001\\u6241\\u5E73\\u7684\\u7ED3\\u6784\\u3002\"}),`\n`]}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[\"\\u7F3A\\u70B9\\uFF1A\",`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"\\u9700\\u8981 O(n) \\u65F6\\u95F4\\u6765\\u67E5\\u627E\\u4E8B\\u4EF6\\u7684\\u76D1\\u542C\\u5668\\uFF0C\\u56E0\\u4E3A\\u60A8\\u5FC5\\u987B\\u67E5\\u770B\\u6574\\u4E2A\\u4E8B\\u4EF6\\u5217\\u8868\\u3002\"}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"emit()\"}),\" \\u548C \",(0,n.jsx)(e.code,{children:\"sub.off()\"}),\" \\u64CD\\u4F5C\\u5C06\\u9700\\u8981\\u904D\\u5386\\u6570\\u7EC4\\uFF0C\\u60A8\\u65E0\\u6CD5\\u7ACB\\u5373\\u786E\\u5B9A\\u4E8B\\u4EF6\\u662F\\u5426\\u5B58\\u5728\\u5E76\\u5FFD\\u7565\\u975E\\u73B0\\u6709\\u4E8B\\u4EF6\\u7684\\u53D1\\u51FA\\u3002\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"\\u7531\\u4E8E\\u91CD\\u590D\\u7684\\u5BF9\\u8C61\\u5B57\\u6BB5\\u548C \",(0,n.jsx)(e.code,{children:\"eventName\"}),\" \\u5B57\\u7B26\\u4E32\\uFF0C\\u53EF\\u80FD\\u9700\\u8981\\u66F4\\u591A\\u7A7A\\u95F4\\u6765\\u5B58\\u50A8\\u6570\\u636E\\u3002\"]}),`\n`]}),`\n`]}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u65B9\\u6CD5 #1 \\u663E\\u7136\\u66F4\\u597D\\uFF0C\\u6240\\u4EE5\\u6211\\u4EEC\\u5C06\\u4F7F\\u7528\\u5B83\\u3002\\u4E3A\\u4E86\\u7F13\\u89E3\\u7528\\u6237\\u63D0\\u4F9B\\u7684 \",(0,n.jsx)(e.code,{children:\"eventName\"}),\" \\u4E0E \",(0,n.jsx)(e.code,{children:\"Object.prototype\"}),\" \\u4E0A\\u7684\\u952E\\u51B2\\u7A81\\u7684\\u95EE\\u9898\\uFF0C\\u6211\\u4EEC\\u53EF\\u4EE5\\u4F7F\\u7528 \",(0,n.jsx)(e.code,{children:\"Object.create(null)\"}),\" \\u5B9E\\u4F8B\\u5316 \",(0,n.jsx)(e.code,{children:\"_events\"}),\" \\u5BF9\\u8C61\\u6216\\u4F7F\\u7528 ES6 \",(0,n.jsx)(e.code,{children:\"Map\"}),\" \\u7C7B\\u3002\"]}),`\n`,(0,n.jsxs)(e.h3,{children:[\"\\u5B9E\\u73B0 \",(0,n.jsx)(e.code,{children:\"emitter.on()\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u5B9E\\u73B0 \",(0,n.jsx)(e.code,{children:\"emitter.on()\"}),\" \\u975E\\u5E38\\u7B80\\u5355\\u3002\\u9996\\u5148\\u68C0\\u67E5 \",(0,n.jsx)(e.code,{children:\"eventName\"}),\" \\u662F\\u5426\\u4F5C\\u4E3A \",(0,n.jsx)(e.code,{children:\"_events\"}),\" \\u5BF9\\u8C61\\u7684\\u952E\\u5B58\\u5728\\uFF0C\\u5982\\u679C\\u8FD9\\u662F\\u7B2C\\u4E00\\u6B21\\u9047\\u5230\\u6B64 \",(0,n.jsx)(e.code,{children:\"eventName\"}),\"\\uFF0C\\u5219\\u5C06\\u8BE5\\u503C\\u8BBE\\u4E3A\\u7A7A\\u5BF9\\u8C61\\uFF08\\u7528\\u4E8E\\u5C06 \",(0,n.jsx)(e.code,{children:\"listenerId\"}),\" \\u6620\\u5C04\\u5230\\u5176\\u76D1\\u542C\\u5668\\uFF09\\u3002\\u7136\\u540E\\u5C06 \",(0,n.jsx)(e.code,{children:\"listener\"}),\" \\u63A8\\u5165\\u6570\\u7EC4\\u3002\"]}),`\n`,(0,n.jsxs)(e.h3,{children:[\"\\u5B9E\\u73B0 \",(0,n.jsx)(e.code,{children:\"sub.off()\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"emitter.on()\"}),\" \\u9700\\u8981\\u8FD4\\u56DE\\u4E00\\u4E2A\\u5177\\u6709 \",(0,n.jsx)(e.code,{children:\"off()\"}),\" \\u65B9\\u6CD5\\u7684\\u5BF9\\u8C61\\u3002\\u4F7F\\u7528\\u4E00\\u4E2A\\u5E26\\u6709 \",(0,n.jsx)(e.code,{children:\"off()\"}),\" \\u65B9\\u6CD5\\u7684\\u666E\\u901A\\u5BF9\\u8C61\\u5C31\\u8DB3\\u591F\\u4E86\\u3002\",(0,n.jsx)(e.code,{children:\"off()\"}),\" \\u65B9\\u6CD5\\u5305\\u542B\\u5BF9 \",(0,n.jsx)(e.code,{children:\"listener\"}),\" \\u7684\\u552F\\u4E00 ID (\",(0,n.jsx)(e.code,{children:\"listenerId\"}),\") \\u548C \",(0,n.jsx)(e.code,{children:\"eventName\"}),\" \\u7684\\u5F15\\u7528\\uFF0C\\u8FD9\\u8981\\u5F52\\u529F\\u4E8E\\u95ED\\u5305\\u3002\\u4F46\\u662F\\uFF0C\\u4E3A\\u4E86\\u8BA9 \",(0,n.jsx)(e.code,{children:\"off()\"}),\" \\u65B9\\u6CD5\\u80FD\\u591F\\u8BBF\\u95EE emitter \\u5B9E\\u4F8B\\u7684 \",(0,n.jsx)(e.code,{children:\"this\"}),\" \\u503C\\uFF0C\\u5E94\\u8BE5\\u4F7F\\u7528\\u7BAD\\u5934\\u51FD\\u6570\\u5B9A\\u4E49\\u5B83\\uFF0C\\u6216\\u8005\\u4F7F\\u7528\\u5355\\u72EC\\u7684 \",(0,n.jsx)(e.code,{children:\"that\"}),\" \\u53D8\\u91CF\\u6765\\u4FDD\\u7559\\u5BF9 \",(0,n.jsx)(e.code,{children:\"this\"}),\" \\u7684\\u5F15\\u7528\\u3002\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u8981\\u4ECE emitter \\u4E2D\\u5220\\u9664\\u76D1\\u542C\\u5668\\uFF0C\\u53EA\\u9700\\u4ECE \",(0,n.jsx)(e.code,{children:\"this.events[eventName]\"}),\" \\u4E2D \",(0,n.jsx)(e.code,{children:\"delete\"}),\" \\u952E\\u5373\\u53EF\\u3002\\u5982\\u679C\\u591A\\u6B21\\u8C03\\u7528 \",(0,n.jsx)(e.code,{children:\"sub.off()\"}),\"\\uFF0C\\u6B64\\u65B9\\u6CD5\\u4E5F\\u6709\\u6548\\uFF0C\\u56E0\\u4E3A\\u5BF9\\u4E0D\\u5B58\\u5728\\u7684\\u952E\\u8FDB\\u884C \",(0,n.jsx)(e.code,{children:\"delete\"}),\" \\u64CD\\u4F5C\\u662F\\u65E0\\u64CD\\u4F5C\\u3002\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-js\",children:`function on(eventName, listener) {\n  // \\u4E3A\\u4E86\\u7B80\\u6D01\\u8D77\\u89C1\\uFF0C\\u7701\\u7565\\u4E86\\u5176\\u4F59\\u7684\\u5B9E\\u73B0\\u3002\n  return {\n    // \\u4F7F\\u7528\\u7BAD\\u5934\\u51FD\\u6570\\u6765\\u4FDD\\u7559 \\`this\\`\\u3002\n    off: () => {\n      delete this.events[eventName][listenerId];\n    },\n  };\n}\n`})}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-js\",children:`function on(eventName, listener) {\n  // \\u4E3A\\u4E86\\u7B80\\u6D01\\u8D77\\u89C1\\uFF0C\\u7701\\u7565\\u4E86\\u5176\\u4F59\\u7684\\u5B9E\\u73B0\\u3002\n  // \\u5B9A\\u4E49\\u4E00\\u4E2A\\u5355\\u72EC\\u7684 \\`that\\` \\u53D8\\u91CF\\u6765\\u4FDD\\u7559\\u5BF9 \\`this\\` \\u7684\\u5F15\\u7528\\u3002\n  const that = this;\n  return {\n    off() {\n      delete that.events[eventName][listenerId];\n    },\n  };\n}\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u6211\\u4EEC\\u53EF\\u4EE5\\u521B\\u5EFA\\u4E00\\u4E2A\\u65B0\\u7684\\u7C7B \",(0,n.jsx)(e.code,{children:\"EventSubscription\"}),\"\\uFF0C\\u5B83\\u5E26\\u6709\\u4E00\\u4E2A \",(0,n.jsx)(e.code,{children:\".off()\"}),\" \\u65B9\\u6CD5\\uFF0C\\u7528\\u4E8E\\u5B9E\\u4F8B\\u5316\\u4E3A\\u4ECE \",(0,n.jsx)(e.code,{children:\"emitter.off()\"}),\" \\u8FD4\\u56DE\\u7684\\u5BF9\\u8C61\\uFF0C\\u8FD9\\u6837\\u505A\\u7684\\u597D\\u5904\\u662F\\u53EF\\u4EE5\\u5728\\u5B9E\\u4F8B\\u4E4B\\u95F4\\u5171\\u4EAB\\u65B9\\u6CD5\\u5B9E\\u73B0\\u3002\\u4F46\\u662F\\uFF0C\\u5185\\u5B58\\u5360\\u7528\\u53EF\\u4EE5\\u5FFD\\u7565\\u4E0D\\u8BA1\\uFF0C\\u800C\\u4E14\\u5B9E\\u9645\\u4E0A\\u6CA1\\u6709\\u5FC5\\u8981\\u3002\"]}),`\n`,(0,n.jsxs)(e.h3,{children:[\"\\u5B9E\\u73B0 \",(0,n.jsx)(e.code,{children:\"EventEmitter.emit()\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u68C0\\u67E5 \",(0,n.jsx)(e.code,{children:\"eventName\"}),\" \\u662F\\u5426\\u5B58\\u5728\\u6216\\u662F\\u5426\\u6709\\u4EFB\\u4F55\\u4E8B\\u4EF6\\uFF0C\\u5982\\u679C \",(0,n.jsx)(e.code,{children:\"eventName\"}),\" \\u4E0D\\u5B58\\u5728\\u6216 \",(0,n.jsx)(e.code,{children:\"eventName\"}),\" \\u6CA1\\u6709\\u4EFB\\u4F55\\u76D1\\u542C\\u5668\\uFF08\\u5BF9\\u8C61\\u4E3A\\u7A7A\\uFF09\\uFF0C\\u6211\\u4EEC\\u53EF\\u4EE5\\u7EC8\\u6B62\\u5E76\\u8FD4\\u56DE \",(0,n.jsx)(e.code,{children:\"false\"}),\"\\u3002\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u4E3A\\u4E86\\u5C06\\u5176\\u4F59\\u7684\\u53C2\\u6570\\u4F20\\u9012\\u7ED9\\u6BCF\\u4E2A\\u76D1\\u542C\\u5668\\uFF0C\\u6211\\u4EEC\\u5FC5\\u987B\\u5728\\u65B9\\u6CD5\\u7B7E\\u540D\\u4E2D\\u4F7F\\u7528 \",(0,n.jsx)(e.code,{children:\"...args\"}),\" \\u6765\\u6355\\u83B7\\u6240\\u6709\\u5176\\u4ED6\\u53C2\\u6570\\u4F5C\\u4E3A\\u53D8\\u91CF \",(0,n.jsx)(e.code,{children:\"args\"}),\"\\u3002\\u53EF\\u4EE5\\u4F7F\\u7528 \",(0,n.jsx)(e.code,{children:\"args\"}),\" \\u901A\\u8FC7 \",(0,n.jsx)(e.code,{children:\"Function.prototype.apply()\"}),\" \\u6216 \",(0,n.jsx)(e.code,{children:\"Function.prototype.call()\"}),\" \\u8C03\\u7528\\u76D1\\u542C\\u5668\\u3002\"]}),`\n`,(0,n.jsxs)(e.h3,{children:[\"\\u5185\\u7F6E\\u5BF9\\u8C61\\u5C5E\\u6027\\u4E0E\\u7528\\u6237\\u63D0\\u4F9B\\u7684 \",(0,n.jsx)(e.code,{children:\"eventName\"}),\" \\u51B2\\u7A81\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u5982\\u4E0A\\u6240\\u8FF0\\uFF0C\\u5982\\u679C\\u60A8\\u4F7F\\u7528\\u666E\\u901A\\u7684 JavaScript \\u5BF9\\u8C61\\u5C06 \",(0,n.jsx)(e.code,{children:\"eventName\"}),\" \\u6620\\u5C04\\u5230\\u56DE\\u8C03\\uFF0C\\u4E00\\u4E2A\\u6F5C\\u5728\\u7684\\u95EE\\u9898\\u662F\\u4F7F\\u7528\\u4E0E JavaScript \\u5BF9\\u8C61\\u4E0A\\u5B58\\u5728\\u7684\\u5C5E\\u6027\\uFF08\\u5982 \",(0,n.jsx)(e.code,{children:\"valueOf\"}),\" \\u548C \",(0,n.jsx)(e.code,{children:\"toString\"}),\"\\uFF09\\u51B2\\u7A81\\u7684 \",(0,n.jsx)(e.code,{children:\"eventName\"}),\"\\u3002\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-js\",children:`const emitter = new EventEmitter();\nemitter.emit('toString'); // \\u53EF\\u80FD\\u4F1A\\u5D29\\u6E83\\uFF0C\\u56E0\\u4E3A\\u8BE5\\u5C5E\\u6027\\u786E\\u5B9E\\u5B58\\u5728\\u4E8E\\u5BF9\\u8C61\\u4E0A\\u3002\n`})}),`\n`,(0,n.jsx)(e.p,{children:\"\\u4E24\\u79CD\\u5904\\u7406\\u65B9\\u6CD5\\uFF1A\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"\\u4F7F\\u7528 \",(0,n.jsx)(e.code,{children:\"Map\"}),\" \\u800C\\u4E0D\\u662F\\u5BF9\\u8C61\\u3002\\u8FD9\\u662F\\u73B0\\u4EE3\\u65B9\\u6CD5\\u3002\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"\\u4F7F\\u7528 \",(0,n.jsx)(e.code,{children:\"Object.create(null)\"}),\" \\u521B\\u5EFA\\u60A8\\u7684\\u666E\\u901A JavaScript \\u5BF9\\u8C61\\uFF0C\\u8FD9\\u6837\\u5BF9\\u8C61\\u5C31\\u6CA1\\u6709\\u539F\\u578B\\uFF0C\\u4E5F\\u6CA1\\u6709\\u5176\\u4ED6\\u5C5E\\u6027\\u3002\"]}),`\n`]}),`\n`,(0,n.jsx)(e.h3,{children:\"\\u57FA\\u4E8E\\u7C7B\\u7684\\u89E3\\u51B3\\u65B9\\u6848\"}),`\n`,(0,n.jsx)(l,{languages:{jsx:a,tsx:m}}),`\n`,(0,n.jsx)(e.h3,{children:\"\\u57FA\\u4E8E\\u51FD\\u6570\\u539F\\u578B\\u7684\\u89E3\\u51B3\\u65B9\\u6848\"}),`\n`,(0,n.jsx)(l,{children:u}),`\n`,(0,n.jsx)(e.h2,{children:\"\\u8FB9\\u7F18\\u60C5\\u51B5\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"\\u76F8\\u540C\\u7684\\u76D1\\u542C\\u5668\\u51FD\\u6570\\u53EF\\u4EE5\\u4E3A\\u540C\\u4E00\\u4E8B\\u4EF6\\u6DFB\\u52A0\\u591A\\u6B21\\u3002\\u8C03\\u7528 \",(0,n.jsx)(e.code,{children:\"sub.off()\"}),\" \\u5E94\\u8BE5\\u5220\\u9664\\u76F8\\u5E94\\u7684\\u76D1\\u542C\\u5668\\uFF0C\\u56E0\\u4E3A\\u8C03\\u7528\\u7684\\u987A\\u5E8F\\u5F88\\u91CD\\u8981\\u3002\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"emitter.emit()\"}),\" \\u5728\\u6CA1\\u6709\\u4EFB\\u4F55\\u53C2\\u6570\\u7684\\u60C5\\u51B5\\u4E0B\\u88AB\\u8C03\\u7528\\u3002\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"\\u65B9\\u6CD5\\u4F7F\\u7528\\u4E0D\\u5B58\\u5728\\u7684 \",(0,n.jsx)(e.code,{children:\"eventName\"}),\" \\u8C03\\u7528\\u3002\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"sub.off()\"}),\" \\u88AB\\u591A\\u6B21\\u8C03\\u7528\\uFF0C\\u4E0D\\u5E94\\u8BE5\\u5D29\\u6E83\\u3002\"]}),`\n`]}),`\n`,(0,n.jsx)(e.h2,{children:\"\\u6280\\u672F\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"\\u9762\\u5411\\u5BF9\\u8C61\\u7F16\\u7A0B\\u3002\"}),`\n`,(0,n.jsx)(e.li,{children:\"\\u4F7F\\u7528\\u6B63\\u786E\\u7684\\u6570\\u636E\\u7ED3\\u6784\\u3002\"}),`\n`,(0,n.jsx)(e.li,{children:\"\\u95ED\\u5305\\u3002\"}),`\n`,(0,n.jsx)(e.li,{children:\"\\u5904\\u7406\\u53EF\\u53D8\\u53C2\\u6570\\u3002\"}),`\n`]}),`\n`,(0,n.jsx)(e.h2,{children:\"\\u7B14\\u8BB0\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"Node.js \\u7684 \",(0,n.jsx)(e.code,{children:\"EventEmitter\"}),\" \\u7684\\u5B9E\\u73B0\\u5141\\u8BB8 \",(0,n.jsx)(e.code,{children:\"eventName\"}),\" \\u4E3A\\u7B26\\u53F7\\uFF0C\\u800C\\u6211\\u4EEC\\u5728\\u8FD9\\u91CC\\u4E0D\\u5141\\u8BB8\\u3002\"]}),`\n`]}),`\n`,(0,n.jsx)(e.h2,{children:\"\\u8D44\\u6E90\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://nodejs.org/api/events.html#class-eventemitter\",children:\"EventEmitter | Node.js\"})}),`\n`]})]})}function I(t={}){let{wrapper:e}=t.components||{};return e?(0,n.jsx)(e,Object.assign({},t,{children:(0,n.jsx)(v,t)})):v(t)}var w=I;return E(F);})();\n;return Component;",
  "workspace": {
    "main": "/src/event-emitter-ii.ts",
    "run": "/src/event-emitter-ii.run.test.ts",
    "submit": "/src/event-emitter-ii.submit.test.ts"
  }
}
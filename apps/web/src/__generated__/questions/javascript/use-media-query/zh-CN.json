{
  "description": "var Component=(()=>{var h=Object.create;var o=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,x=Object.prototype.hasOwnProperty;var f=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),g=(n,e)=>{for(var i in e)o(n,i,{get:e[i],enumerable:!0})},d=(n,e,i,c)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let t of m(e))!x.call(n,t)&&t!==i&&o(n,t,{get:()=>e[t],enumerable:!(c=u(e,t))||c.enumerable});return n};var M=(n,e,i)=>(i=n!=null?h(p(n)):{},d(e||!n||!n.__esModule?o(i,\"default\",{value:n,enumerable:!0}):i,n)),_=n=>d(o({},\"__esModule\",{value:!0}),n);var l=f((C,a)=>{a.exports=_jsx_runtime});var y={};g(y,{default:()=>v,frontmatter:()=>j});var r=M(l()),j={title:\"useMediaQuery\",excerpt:\"\\u5B9E\\u73B0\\u4E00\\u4E2A\\u8BA2\\u9605\\u5E76\\u54CD\\u5E94\\u5A92\\u4F53\\u67E5\\u8BE2\\u53D8\\u5316\\u7684 Hook\\uFF08\\u4F8B\\u5982\\u5C4F\\u5E55\\u5927\\u5C0F\\u3001\\u5206\\u8FA8\\u7387\\u3001\\u65B9\\u5411\\u7B49\\uFF09\"};function s(n){let e=Object.assign({p:\"p\",code:\"code\",pre:\"pre\",a:\"a\",h2:\"h2\",ul:\"ul\",li:\"li\"},n.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(e.p,{children:[\"\\u5B9E\\u73B0\\u4E00\\u4E2A \",(0,r.jsx)(e.code,{children:\"useMediaQuery\"}),\" Hook\\uFF0C\\u7528\\u4E8E\\u8BA2\\u9605\\u5E76\\u54CD\\u5E94\\u5A92\\u4F53\\u67E5\\u8BE2\\u7684\\u53D8\\u5316\\uFF08\\u4F8B\\u5982\\u5C4F\\u5E55\\u5927\\u5C0F\\u3001\\u5206\\u8FA8\\u7387\\u3001\\u65B9\\u5411\\u7B49\\uFF09\\u3002\"]}),`\n`,(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:\"language-jsx\",children:`export default function Component() {\n  const isSmallDevice = useMediaQuery('only screen and (max-width: 768px)');\n\n  return <div>{isSmallDevice && <a href=\"#\">Menu</a>}</div>;\n}\n`})}),`\n`,(0,r.jsxs)(e.p,{children:[\"\\u63D0\\u793A\\uFF1A\",(0,r.jsxs)(e.a,{href:\"https://developer.mozilla.org/en-US/docs/Web/API/Window/matchMedia\",children:[(0,r.jsx)(e.code,{children:\"window.matchMedia\"}),\" API\"]}),\" \\u53EF\\u80FD\\u4F1A\\u6709\\u6240\\u5E2E\\u52A9\\u3002\"]}),`\n`,(0,r.jsx)(e.h2,{children:\"\\u53C2\\u6570\"}),`\n`,(0,r.jsxs)(e.ul,{children:[`\n`,(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:\"query: string\"}),\"\\uFF1A\\u8981\\u5339\\u914D\\u7684\\u5A92\\u4F53\\u67E5\\u8BE2\\u3002\\u5B83\\u5FC5\\u987B\\u662F\",(0,r.jsx)(e.a,{href:\"https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries/Using_media_queries\",children:\"\\u6709\\u6548\\u7684 CSS \\u5A92\\u4F53\\u67E5\\u8BE2\\u5B57\\u7B26\\u4E32\"})]}),`\n`]}),`\n`,(0,r.jsx)(e.h2,{children:\"\\u8FD4\\u56DE\\u503C\"}),`\n`,(0,r.jsx)(e.p,{children:\"\\u8BE5 Hook \\u8FD4\\u56DE\\u4E00\\u4E2A\\u5E03\\u5C14\\u503C\\uFF0C\\u6307\\u793A\\u5A92\\u4F53\\u67E5\\u8BE2\\u662F\\u5426\\u5339\\u914D\\u3002\"})]})}function S(n={}){let{wrapper:e}=n.components||{};return e?(0,r.jsx)(e,Object.assign({},n,{children:(0,r.jsx)(s,n)})):s(n)}var v=S;return _(y);})();\n;return Component;",
  "files": {
    "/package.json": "{\n  \"name\": \"@gfe-questions/use-media-query\",\n  \"version\": \"0.0.1\",\n  \"main\": \"/src/use-media-query.ts\",\n  \"dependencies\": {\n    \"@testing-library/react\": \"14.0.0\",\n    \"react\": \"18.2.0\",\n    \"react-dom\": \"18.2.0\"\n  },\n  \"devDependencies\": {\n    \"@types/jest\": \"29.5.0\",\n    \"@types/react\": \"18.2.25\",\n    \"@types/react-dom\": \"18.2.10\",\n    \"typescript\": \"5.0.2\"\n  }\n}\n",
    "/tsconfig.json": "{\n  \"include\": [\"./**/*\"],\n  \"compilerOptions\": {\n    \"strict\": true,\n    \"esModuleInterop\": true,\n    \"lib\": [\"dom\", \"dom.iterable\", \"esnext\"],\n    \"jsx\": \"react-jsx\",\n    \"target\": \"es2020\"\n  }\n}\n",
    "/src/use-media-query.run.test.ts": "import { act, renderHook } from '@testing-library/react';\n\nimport useMediaQuery from './use-media-query';\n\nlet changeListeners: (() => void)[] = [];\n\nclass MockMatchMedia {\n  readonly media: string;\n\n  constructor(query: string) {\n    this.media = query;\n  }\n\n  get matches() {\n    if (this.media.includes('min-width')) {\n      return window.innerWidth >= parseInt(this.media.match(/\\d+/)![0]);\n    }\n\n    if (this.media.includes('max-width')) {\n      return window.innerWidth <= parseInt(this.media.match(/\\d+/)![0]);\n    }\n  }\n\n  addEventListener(type: string, listener: () => void) {\n    if (type !== 'change') {\n      return;\n    }\n\n    changeListeners.push(listener);\n  }\n\n  removeEventListener(type: string, listener: () => void) {\n    if (type !== 'change') {\n      return;\n    }\n\n    changeListeners.splice(changeListeners.indexOf(listener), 1);\n  }\n\n  dispatchEvent(event: Event) {\n    if (event.type !== 'change') {\n      return;\n    }\n\n    changeListeners.forEach((listener) => listener());\n  }\n}\n\ndescribe('useMediaQuery', () => {\n  beforeEach(() => {\n    changeListeners = [];\n\n    // @ts-ignore\n    Object.defineProperty(global.window, 'matchMedia', {\n      writable: true,\n      value: jest.fn().mockImplementation((query: string) => {\n        return new MockMatchMedia(query);\n      }),\n    });\n  });\n\n  test('return values', () => {\n    const { result } = renderHook(() => useMediaQuery('(min-width: 1000px)'));\n\n    expect(typeof result.current).toBe('boolean');\n  });\n\n  test('min-width', () => {\n    const { result } = renderHook(() => useMediaQuery('(min-width: 1000px)'));\n\n    expect(result.current).toBe(window.innerWidth >= 1000);\n  });\n\n  test('max-width', () => {\n    const { result } = renderHook(() => useMediaQuery('(max-width: 1000px)'));\n\n    expect(result.current).toBe(window.innerWidth <= 1000);\n  });\n});\n",
    "/src/use-media-query.submit.test.ts": "import { act, renderHook } from '@testing-library/react';\n\nimport useMediaQuery from './use-media-query';\n\nlet changeListeners: (() => void)[] = [];\n\nclass MockMatchMedia {\n  readonly media: string;\n\n  constructor(query: string) {\n    this.media = query;\n  }\n\n  get matches() {\n    if (this.media.includes('min-width')) {\n      return window.innerWidth >= parseInt(this.media.match(/\\d+/)![0]);\n    }\n\n    if (this.media.includes('max-width')) {\n      return window.innerWidth <= parseInt(this.media.match(/\\d+/)![0]);\n    }\n  }\n\n  addEventListener(type: string, listener: () => void) {\n    if (type !== 'change') {\n      return;\n    }\n\n    changeListeners.push(listener);\n  }\n\n  removeEventListener(type: string, listener: () => void) {\n    if (type !== 'change') {\n      return;\n    }\n\n    changeListeners.splice(changeListeners.indexOf(listener), 1);\n  }\n\n  dispatchEvent(event: Event) {\n    if (event.type !== 'change') {\n      return;\n    }\n\n    changeListeners.forEach((listener) => listener());\n  }\n}\n\ndescribe('useMediaQuery', () => {\n  beforeEach(() => {\n    changeListeners = [];\n\n    // @ts-ignore\n    Object.defineProperty(global.window, 'matchMedia', {\n      writable: true,\n      value: jest.fn().mockImplementation((query: string) => {\n        return new MockMatchMedia(query);\n      }),\n    });\n  });\n\n  test('return values', () => {\n    const { result } = renderHook(() => useMediaQuery('(min-width: 1000px)'));\n\n    expect(typeof result.current).toBe('boolean');\n  });\n\n  test('min-width', () => {\n    const { result } = renderHook(() => useMediaQuery('(min-width: 1000px)'));\n\n    expect(result.current).toBe(window.innerWidth >= 1000);\n  });\n\n  test('max-width', () => {\n    const { result } = renderHook(() => useMediaQuery('(max-width: 1000px)'));\n\n    expect(result.current).toBe(window.innerWidth <= 1000);\n  });\n\n  test('resize min-width', () => {\n    const query = `(min-width: ${window.innerWidth}px)`;\n    const { result } = renderHook(() => useMediaQuery(query));\n\n    expect(result.current).toBe(true);\n\n    act(() => {\n      window.innerWidth -= 100;\n      window.matchMedia(query).dispatchEvent(new Event('change'));\n    });\n\n    expect(result.current).toBe(false);\n\n    act(() => {\n      window.innerWidth += 200;\n      window.matchMedia(query).dispatchEvent(new Event('change'));\n    });\n\n    expect(result.current).toBe(true);\n  });\n\n  test('resize max-width', () => {\n    const query = `(max-width: ${window.innerWidth}px)`;\n    const { result } = renderHook(() => useMediaQuery(query));\n\n    expect(result.current).toBe(true);\n\n    act(() => {\n      window.innerWidth += 100;\n      window.matchMedia(query).dispatchEvent(new Event('change'));\n    });\n\n    expect(result.current).toBe(false);\n\n    act(() => {\n      window.innerWidth -= 200;\n      window.matchMedia(query).dispatchEvent(new Event('change'));\n    });\n\n    expect(result.current).toBe(true);\n  });\n\n  test('removes event listeners on unmount', () => {\n    const { unmount } = renderHook(() => useMediaQuery('(min-width: 1000px)'));\n\n    expect(changeListeners).not.toHaveLength(0);\n\n    unmount();\n\n    expect(changeListeners).toHaveLength(0);\n  });\n});\n",
    "/src/use-media-query.ts": "import { useEffect, useState } from 'react';\n\nexport default function useMediaQuery(query: string): boolean {\n  const [matches, setMatches] = useState(\n    () => window.matchMedia(query).matches,\n  );\n\n  useEffect(() => {\n    const mediaQueryList = window.matchMedia(query);\n\n    function updateMatch() {\n      setMatches(mediaQueryList.matches);\n    }\n\n    mediaQueryList.addEventListener('change', updateMatch);\n\n    return () => {\n      mediaQueryList.removeEventListener('change', updateMatch);\n    };\n  }, [query]);\n\n  return matches;\n}\n"
  },
  "info": {
    "excerpt": "实现一个订阅并响应媒体查询变化的 Hook（例如屏幕大小、分辨率、方向等）",
    "title": "useMediaQuery"
  },
  "metadata": {
    "access": "free",
    "author": "phillmont",
    "companies": [],
    "created": 1742169600,
    "difficulty": "medium",
    "duration": 20,
    "featured": false,
    "format": "javascript",
    "frameworkDefault": "react",
    "frameworks": [
      {
        "framework": "react",
        "href": "/questions/javascript/use-media-query"
      }
    ],
    "href": "/questions/javascript/use-media-query",
    "importance": "medium",
    "languages": [
      "js",
      "ts"
    ],
    "nextQuestions": [],
    "published": true,
    "ranking": 100,
    "similarQuestions": [
      "use-breakpoint",
      "use-window-size"
    ],
    "slug": "use-media-query",
    "subtitle": null,
    "topics": [
      "react-hooks"
    ]
  },
  "skeleton": {
    "js": "/**\n * @param {string} query\n * @returns {boolean}\n */\nexport default function useMediaQuery(query) {\n  throw 'Not implemented';\n}",
    "ts": "export default function useMediaQuery(query: string): boolean {\n  throw 'Not implemented';\n}"
  },
  "solution": "var Component=(()=>{var y=Object.create;var a=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var f=Object.getOwnPropertyNames;var M=Object.getPrototypeOf,S=Object.prototype.hasOwnProperty;var g=(c,e)=>()=>(e||c((e={exports:{}}).exports,e),e.exports),x=(c,e)=>{for(var r in e)a(c,r,{get:e[r],enumerable:!0})},o=(c,e,r,d)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let t of f(e))!S.call(c,t)&&t!==r&&a(c,t,{get:()=>e[t],enumerable:!(d=p(e,t))||d.enumerable});return c};var b=(c,e,r)=>(r=c!=null?y(M(c)):{},o(e||!c||!c.__esModule?a(r,\"default\",{value:c,enumerable:!0}):r,c)),Q=c=>o(a({},\"__esModule\",{value:!0}),c);var h=g((j,s)=>{s.exports=_jsx_runtime});var k={};x(k,{default:()=>v});var n=b(h());var i=MDXCodeBlock;var l=`import { useEffect, useState } from 'react';\n\nexport default function useMediaQuery(query: string): boolean {\n  const [matches, setMatches] = useState(\n    () => window.matchMedia(query).matches,\n  );\n\n  useEffect(() => {\n    const mediaQueryList = window.matchMedia(query);\n\n    function updateMatch() {\n      setMatches(mediaQueryList.matches);\n    }\n\n    mediaQueryList.addEventListener('change', updateMatch);\n\n    return () => {\n      mediaQueryList.removeEventListener('change', updateMatch);\n    };\n  }, [query]);\n\n  return matches;\n}\n`;var u=`import { useCallback, useSyncExternalStore } from 'react';\n\nexport default function useMediaQuery(query: string): boolean {\n  const subscribe = useCallback(\n    (callback: () => void) => {\n      const mediaQueryList = window.matchMedia(query);\n\n      mediaQueryList.addEventListener('change', callback);\n\n      return () => {\n        mediaQueryList.removeEventListener('change', callback);\n      };\n    },\n    [query],\n  );\n\n  return useSyncExternalStore(\n    subscribe,\n    () => window.matchMedia(query).matches,\n  );\n}\n`;function m(c){let e=Object.assign({h2:\"h2\",p:\"p\",code:\"code\",ol:\"ol\",li:\"li\",pre:\"pre\",h3:\"h3\",a:\"a\"},c.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.h2,{children:\"\\u89E3\\u51B3\\u65B9\\u6848\"}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"window.matchMedia(query)\"}),\" \\u662F\\u4E00\\u4E2A JavaScript \\u65B9\\u6CD5\\uFF0C\\u7528\\u4E8E\\u68C0\\u67E5\\u6587\\u6863\\u662F\\u5426\\u4E0E\\u7ED9\\u5B9A\\u7684 CSS \\u5A92\\u4F53\\u67E5\\u8BE2\\u5339\\u914D\\u3002\\u5B83\\u8FD4\\u56DE\\u4E00\\u4E2A \",(0,n.jsx)(e.code,{children:\"MediaQueryList\"}),\" \\u5BF9\\u8C61\\uFF0C\\u8BE5\\u5BF9\\u8C61\\u63D0\\u4F9B\\uFF1A\"]}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\".matches\"}),\" (\\u5E03\\u5C14\\u503C)\\uFF1A\\u6307\\u793A\\u6587\\u6863\\u5F53\\u524D\\u662F\\u5426\\u4E0E\\u5A92\\u4F53\\u67E5\\u8BE2\\u5339\\u914D\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:'.addEventListener(\"change\", callback)'}),\"\\uFF1A\\u4FA6\\u542C\\u5A92\\u4F53\\u67E5\\u8BE2\\u5339\\u914D\\u72B6\\u6001\\u7684\\u53D8\\u5316\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:'.removeEventListener(\"change\", callback)'}),\"\\uFF1A\\u5728\\u4E0D\\u518D\\u9700\\u8981\\u65F6\\u5220\\u9664\\u4E8B\\u4EF6\\u4FA6\\u542C\\u5668\"]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u4F8B\\u5B50\\uFF1A\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-js\",children:`const mediaQuery = window.matchMedia('(max-width: 768px)');\n\nif (mediaQuery.matches) {\n  console.log('\\u89C6\\u53E3\\u4E3A 768px \\u6216\\u66F4\\u5C0F');\n}\n\nmediaQuery.addEventListener('change', (e) => {\n  console.log(e.matches ? '\\u73B0\\u5728\\u662F\\u5C0F\\u5C4F\\u5E55' : '\\u73B0\\u5728\\u662F\\u5927\\u5C4F\\u5E55');\n});\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"useMediaQuery\"}),\" \\u662F\\u4E00\\u4E2A hook\\uFF0C\\u5B83\\u5141\\u8BB8 React \\u5E94\\u7528\\u7A0B\\u5E8F\\u5229\\u7528\\u6B64\\u6D4F\\u89C8\\u5668 API \\u5E76\\u54CD\\u5E94\\u5A92\\u4F53\\u53D8\\u5316\\uFF08\\u4F8B\\u5982\\u5C4F\\u5E55\\u5927\\u5C0F\\u3001\\u5206\\u8FA8\\u7387\\u3001\\u65B9\\u5411\\u7B49\\uFF09\\u3002\"]}),`\n`,(0,n.jsxs)(e.h3,{children:[\"\\u65B9\\u6CD5 1\\uFF1A\",(0,n.jsx)(e.code,{children:\"useEffect\"}),\" \\u548C \",(0,n.jsx)(e.code,{children:\"useState\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u53EF\\u4EE5\\u4F7F\\u7528 \",(0,n.jsx)(e.code,{children:\"useState\"}),\" hook \\u5B58\\u50A8\\u5F53\\u524D\\u7684\\u5A92\\u4F53\\u67E5\\u8BE2\\u5339\\u914D\\u9879\\uFF0C\\u5E76\\u4F7F\\u7528 \",(0,n.jsx)(e.code,{children:\"useEffect\"}),\" hook \\u5728\\u5A92\\u4F53\\u67E5\\u8BE2\\u66F4\\u6539\\u65F6\\u66F4\\u65B0\\u5339\\u914D\\u9879\\u6765\\u5B9E\\u73B0 \",(0,n.jsx)(e.code,{children:\"useMediaQuery\"}),\" hook\\u3002\\u6211\\u4EEC\\u53EF\\u4EE5\\u5C06\\u4FA6\\u542C\\u5668\\u9644\\u52A0\\u5230 \",(0,n.jsx)(e.code,{children:\"window.matchMedia(...)\"}),\" \\u8FD4\\u56DE\\u7684 \",(0,n.jsx)(e.code,{children:\"MediaQueryList\"}),\" \\u5BF9\\u8C61\\u4E0A\\u7684 \",(0,n.jsxs)(e.a,{href:\"https://developer.mozilla.org/en-US/docs/Web/API/MediaQueryList/change_event\",children:[(0,n.jsx)(e.code,{children:\"change\"}),\" \\u4E8B\\u4EF6\"]}),\" \\u4EE5\\u66F4\\u65B0\\u5339\\u914D\\u72B6\\u6001\\u3002\"]}),`\n`,(0,n.jsx)(i,{children:l}),`\n`,(0,n.jsxs)(e.h3,{children:[\"\\u65B9\\u6CD5 2\\uFF1A\",(0,n.jsx)(e.code,{children:\"useSyncExternalStore\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"React \\u7684 \",(0,n.jsx)(e.a,{href:\"https://react.dev/reference/react/useSyncExternalStore\",children:(0,n.jsx)(e.code,{children:\"useSyncExternalStore\"})}),\" hook \\u66F4\\u597D\\uFF0C\\u56E0\\u4E3A\\u5B83\\u65E8\\u5728\\u5C06 React \\u72B6\\u6001\\u4E0E\\u5916\\u90E8\\u7CFB\\u7EDF\\u540C\\u6B65\\uFF0C\\u4F8B\\u5982\",(0,n.jsx)(e.a,{href:\"https://react.dev/reference/react/useSyncExternalStore#subscribing-to-a-browser-api\",children:\"\\u8BA2\\u9605\\u539F\\u751F\\u6D4F\\u89C8\\u5668 API\"}),\"\\u3002\"]}),`\n`,(0,n.jsx)(i,{children:u})]})}function w(c={}){let{wrapper:e}=c.components||{};return e?(0,n.jsx)(e,Object.assign({},c,{children:(0,n.jsx)(m,c)})):m(c)}var v=w;return Q(k);})();\n;return Component;",
  "workspace": {
    "main": "/src/use-media-query.ts",
    "run": "/src/use-media-query.run.test.ts",
    "submit": "/src/use-media-query.submit.test.ts"
  }
}
import MDXCodeBlock from 'MDXCodeBlock';

import onceJs from '../setup/src/once.js';
import onceTs from '../setup/src/once.ts';

## Solution

We can use closures to capture state required by the returned function. The returned function's closure has access to the following variables:

- `func`: The argument to `once()`, the callback function to be invoked.
- `ranOnce`: A boolean variable indicating if the callback function has been invoked before. If the value is `true`, `func` will not be invoked again.
- `value`: Since we need to return the value of the first invocation for subsequent invocations, we have to save the result of the first invocation and return it directly for subsequent invocations.

<MDXCodeBlock languages={{ jsx: onceJs, tsx: onceTs }} />

Note that the callback function is invoked with the `this` binding and arguments of the created function, hence we cannot return an arrow function if we want the value of `this` to refer to the object calling the created function.

## Edge cases

- Functions which access `this`.

## Techniques

- Closures.
- How `this` works.
- Invoking functions via `Function.prototype.apply()`/`Function.prototype.call()`.

## Resources

- [Lodash `_.once`](https://lodash.com/docs/4.17.15#once)

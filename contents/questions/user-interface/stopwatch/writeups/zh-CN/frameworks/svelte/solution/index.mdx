import TestCases from '../../../test-cases.mdx';
import Notes from '../../../notes.mdx';

## 解决方案

这个问题乍一看很简单，但实际上比看起来更复杂。请注意，`setInterval` 的 `delay` 参数是不可靠的。由于各种原因，回调函数被调用的实际时间可能[比给定的延迟时间长](https://developer.mozilla.org/en-US/docs/Web/API/setTimeout#reasons_for_delays_longer_than_specified)。由于这种行为，我们不能假设每次触发间隔回调时，经过的时间都相同。我们需要在回调代码中读取当前时间，以确保我们使用最新的计时。

### 状态

这个问题的棘手之处在于决定组件状态中包含什么以及如何管理它们。我们需要几个状态：

* `lastTickTiming`：一个变量，用于保存上次计时器滴答的时间戳。这对于确定自上次滴答以来经过了多少时间至关重要。
* `totalDuration`：维护自计时器启动以来经过的总时间（以毫秒为单位）。
* `timerId`：对间隔函数的引用，有助于启动、暂停或停止计时器。
* `isRunning`：一个派生状态，用于检查计时器当前是否正在运行。这取决于 `timerId` 是否为 null。

计时器的操作主要有三个核心函数：

* `startTimer`：通过设置上次滴答计时并创建一个间隔函数来初始化计时器，该函数每毫秒更新 `totalDuration`。
* `stopInterval`：清除间隔，有效地暂停计时器。
* `resetTimer`：将计时器的状态重置为其初始值。

最后，`toggleTimer` 函数是一种方便的方式，可以根据计时器的当前状态在启动和停止计时器之间切换。

### 渲染

渲染的一些重要方面包括：

* **动态计时器显示**：时间显示是动态构建的，仅在小时或分钟不为零时才显示。这样可以避免在计时器只有几秒或几毫秒时显示“0h 0m”。
* **样式**：计时器的样式使其看起来像一个现代的数字计时器。数字明显大于单位（如“h”、“m”、“s”），并且毫秒略小于秒，以便在显示中形成清晰的层次结构。`gap` CSS 属性用于保持单位之间的一致间距。
* **计时器控制按钮**：两个主要按钮允许用户控制计时器：
  * 一个按钮切换计时器的运行状态，当计时器运行时显示“停止”，当计时器暂停时显示“开始”。
  * 一个“重置”按钮，将计时器重置为其初始状态。

通过结合上述功能，此 Svelte 代码提供了一个用户友好的交互式秒表，可以准确地跟踪和显示经过的时间。

<TestCases />

<Notes />

import TestCases from '../../../test-cases.mdx';
import Notes from '../../../notes.mdx';

## 解决方案

此代码使用 Composition API。

### 响应式状态

该代码利用几个响应式状态来管理应用程序的行为和数据流：

* `fetchingJobDetails`：此状态变量跟踪当前是否正在从 API 获取作业详细信息。它用于禁用“加载更多”按钮，并在获取过程中向用户提供反馈。
* `jobIds`：此状态变量存储从 Hacker News API 检索的作业 ID 数组。它最初设置为 `null`，稍后使用来自 API 的数据填充。它允许分页并根据 ID 获取作业详细信息。
* `jobs`：此状态变量维护一个作业对象数组，其中包含作业标题、作者、时间和 URL 等详细信息。它最初为 `null`，并在从 API 获取作业详细信息时更新。
* `page`：此状态变量跟踪当前页码，确定要获取哪一组作业 ID 和详细信息。当用户单击“加载更多”按钮时，它会递增。

### 渲染

渲染代码的一些显著方面包括：

* 使用 CSS Grid 显示帖子列表：作业发布使用 `display: grid` CSS 属性以网格布局显示。这是一种允许作业发布之间保持一致间距的便捷方法。
* “加载更多”按钮的样式：使用特定的背景颜色、边框和填充来设置“加载更多”按钮的样式，使其在视觉上突出。该按钮在悬停时也会更改颜色，以便向用户提供视觉反馈。

### 获取数据

#### `fetchJobIds`

此异步方法负责从 Hacker News API 获取当前页的作业 ID 列表，并使用当前页码作为参数调用。

由于 API 只有一个用于获取所有热门职位列表的端点，因此我们只需要获取一次列表并将其保存为状态中的 `jobIds`，方法是向 API 端点发出 `GET` 请求。检索到作业 ID 后，它会根据当前页面对数组进行切片，并返回相关的作业 ID 子集。对该函数的后续调用将只是对数组进行切片，而不会再次获取数据。

#### `fetchJobs`

此异步方法根据从 `fetchJobIds` 方法获得的作业 ID 获取作业详细信息。它使用当前页码作为参数调用。在方法内部，它调用 `fetchJobIds(currPage)` 以获取当前页的作业 ID，然后将 `fetchingJobDetails` 状态变量设置为 `true`，以指示正在获取作业详细信息。使用 `Promise.all`，它向 Hacker News API 发出多个 GET 请求，以获取每个作业的详细信息，使用当前页的作业 ID。获得作业详细信息后，它通过将新获取的作业附加到现有作业来更新 `jobs` 状态变量。最后，它将 `fetchingJobDetails` 设置回 false，以指示获取过程已完成。

`watch` Reactivity API 负责在 `page` 更改时触发 `fetchJobs` 方法。它确保当页码更新时（例如，当用户单击“加载更多”按钮时），将调用 `fetchJobs` 方法以获取新页面的相应作业详细信息。建议使用 `watch` 将作业详细信息数据与当前页面同步，而不是在单击“加载更多”按钮时触发 `fetchJobs`，因为它很容易扩展到其他分页来源，例如无限滚动、其他分页按钮等。

<TestCases />

<Notes />

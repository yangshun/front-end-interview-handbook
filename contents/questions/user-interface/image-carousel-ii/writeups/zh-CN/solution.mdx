## 解决方案

### 结构

实现图片轮播最简单的方法之一是在一个容器内以水平方式渲染所有图片（图片将水平溢出），然后更改水平偏移量。

使用这种结构，可以在两种方式之间切换图片：（1）更改容器的滚动位置，以及（2）在容器上使用 CSS 转换。

#### 1. 滚动位置

通过将图片放在一行中，并将容器限制为与图片轮播尺寸相同的大小，图片将占用比容器更长的水平空间，并且要查看各种图片，可以修改容器的 `scrollOffset`。结合 [CSS 滚动捕捉](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_scroll_snap) 属性，触摸板和触摸屏用户可以水平滚动/滑动图片。此方法根本不涉及 JavaScript，如果您只需要一个基本的水平图片轮播，强烈建议使用此方法。

为了支持分页按钮交互，您可以使用 [`Element.scroll()` 方法](https://developer.mozilla.org/en-US/docs/Web/API/Element/scroll) 以编程方式设置滚动位置。

```js
containerEl.scroll({
  left: 100, // 根据图片的大小计算此偏移值。
  behavior: 'smooth', // 免费获得平滑过渡！
});
```

#### 2. CSS 转换

更改显示的图片的另一种方法是在容器上添加 `transform: translateX(100px)`。要转换的值取决于图片的大小。该解决方案实现了此方法，因为它实现起来稍微复杂一些，并且提供了更多的学习价值。

#### 确定要滚动/转换多少

使用此偏移技术，对于各种图片：

| 图片编号 | 偏移量            |
| --------- | ----------------- |
| 1         | 0                 |
| 2         | 一张图片的宽度   |
| 3         | 两张图片的宽度   |
| 4         | 三张图片的宽度 |

观察到偏移量可以用 `(index - 1) * imageWidth` 确定。但是，由于图片具有动态宽度（当屏幕小于 600px 时），因此图片宽度值无法提前获得，必须在运行时计算。

我们可以获取对图片轮播根元素的引用，并使用 `el.getBoundingClientRect().width` 获取图片的宽度。

### 过渡

使用 CSS 转换方法，可以通过以下 CSS 轻松启用过渡：

```css
transition: transform 0.5s linear;
```

只需将 `transform` 属性设置为新的 `translateX()` 值，浏览器就会将容器平滑过渡到新位置，显示新图片。

### 调整大小

使用基于偏移量的方法进行过渡的一个问题是，如果图像轮播的宽度发生变化，当前的偏移量（基于图像尺寸）将不再准确。

因此，我们需要监听窗口`resize`事件，并将`imageWidth`作为组件状态的一部分，以便组件在`imageWidth`更改时更新偏移量。

如果`transition`样式永久应用于图像容器，当由于调整大小而导致偏移量发生变化时，将会看到一些过渡效果，看起来有点奇怪。因此，`transition`样式应该仅在由于导航事件而不是调整大小而导致偏移量发生变化时添加。

### 基于偏移量的方法的缺点

基于偏移量的方法相对容易实现。您还应该了解这种方法的缺点：

1. **更大的 DOM 占用空间**：所有图像从一开始就存在于 DOM 中。如果有很多图像，可能会导致性能不佳。这可以通过列表虚拟化和/或图像的延迟加载来缓解。
2. **过渡距离可能很大**：从第一张图像过渡到最后一张图像，反之亦然（更广义地说，跨越多张图像）可能是一种令人不快的体验，因为浏览器将滚动浏览所有中间图像。

## 后续行动

有很多方法可以实现图像轮播，每种方法都有其自身的优点和局限性。[Image Carousel III](/questions/user-interface/image-carousel-iii) 探讨了一种不同的、性能更好的方法，其中只有当前图像和下一张图像被渲染到 DOM 中，并解决了基于偏移量方法的一些缺点。

import TestCases from '../../../test-cases.mdx';

## 解决方案

### Props

为了灵活使用，可以使用以下方式修改记忆游戏：

* `rows`：确定行数。
* `cols`：确定列数。
* `matchCount`：指定应该有多少个相同的图像。默认值为 2，但将其设置为可调整的功能很有用。
* `delay`：决定非匹配卡牌翻转回背面的时间间隔。

我们需要验证这些配置，以确保它们产生一个可玩的游戏。一种这样的验证是确保总单元格数可以被匹配计数整除而没有余数。

### 状态管理

* `cards`：一个描述游戏板的一维数组。它包含表情符号组（基于 `matchCount`）。例如，在一个 4 x 4 的棋盘中，数组的大小为 16，`cards[4]` 对应于第 2 行第 1 列的卡牌。它仅在开始新游戏时重新生成。
* `flipped`：存储尚未匹配的翻牌索引。
* `matched`：一个用于存储已找到匹配对的表情符号的集合。
* `waitTimer`：用于跟踪在 `delay` 持续时间之后自动翻牌的计时器。
* `gameCompleted`：一个布尔值，用于跟踪是否所有对都已匹配。

### 渲染

CSS 网格用于以二维格式渲染卡牌。这是一个很好的选择，因为您可以将卡牌渲染为单个 DOM 元素列表，但使用正确的 CSS 网格设置，它们可以显示在 rows x cols 布局中。

### 生成卡牌

卡牌创建如下：

1. 在单个数组中制作 N 组 `matchCount` 表情符号，其中 N = 总单元格 / `matchCount`。
2. 随机排列数组。

### `onFlip`

在大多数情况下，`onFlip` 将卡牌添加到 `selected` 数组中。如果没有足够的卡牌来决定是否匹配，则该函数终止。当选择了足够的卡牌时，检查所有选定的卡牌是否相似。如果是，我们可以将选定的表情符号添加到 `matched` 集合中，并将 `selected` 重置为空，以便玩家可以继续游戏。如果没有匹配项，我们等待 `delay` 持续时间过去，然后再将选定的卡牌翻转回来。

如果玩家在 `delay` 结束之前尝试翻转更多卡牌，则需要立即重置已翻转的卡牌（未匹配）。使用 `clearTimeout` 和存储在 `waitTimer` 中的计时器可以实现这一点。

在 Svelte 中，通过 `$:` 的反应系统确保高效地完成对游戏状态的检查和更新。当像 `cols`、`rows` 或 `matchCount` 这样的 props 发生变化时，必要的函数和验证会自动重新调用。

<TestCases />

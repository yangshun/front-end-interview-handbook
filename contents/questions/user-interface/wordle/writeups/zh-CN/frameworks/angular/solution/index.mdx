import TestCases from '../../../test-cases.mdx';

## 解决方案

在 `AppComponent` 中，我们将使用给定的参数创建游戏，整个逻辑将在容器 `WordleComponent` 中进行。其余组件 `LetterGridComponent`、`KeyboardComponent` 和 `GameResultComponent` 将是仅用于显示 UI 且不处理逻辑的哑组件。

### `LetterGridComponent`

根据 `LetterGuessState` 枚举显示网格并设置适当的样式。

### `KeyboardComponent`

顾名思义，此组件负责与键盘交互。根据 `LetterGuessState`，它还会设置 UI 上按键的样式，并且按下的每个字母都会发送到容器 `WordleComponent`。

### `GameResultComponent`

根据游戏结果显示游戏结果，并允许重置游戏。

### `WordleComponent`

容器组件，它将管理整个游戏逻辑并保存状态。根据给定的输入 `lettersPerWord` 和 `maxAttempts`，它将在 hook `ngOnInit` 中配置游戏规则。

#### `addLetter`

按下字母键时调用此函数。如果行中有可用空间，它会将按下的字母添加到当前光标位置的网格中。

#### `deleteLetter`

按下退格键时调用此函数。它将删除网格中当前光标位置的字母。如果当前行中没有字母，则调用此函数不会执行任何操作。

#### `checkWord`

当按下回车键以检查当前行中的单词是否正确时，将调用此函数。此函数有几个主要部分：

1. 首先，检查每个字母是否完全匹配。网格和字母猜测的状态更新为 `'CORRECT'`。如果所有字母都匹配，我们可以终止该函数并结束游戏。
2. 接下来，我们更新剩余字符的状态。剩余字符可以是以下之一：
   * 存在：如果字符存在于 `letterFreq` 中，并且 `letterFreq.get(char)` 为 0，则表示它已在上一步中被标记为 `'CORRECT'`。正值表示该字符存在但不在正确的位置。我们需要使用频率而不是简单地检查字符的存在，因为一个单词可以使用相同的字符多次。这些字符将被标记为 `'PRESENT'`。
   * 缺席：该字符根本不存在于 `letterFreq` 中，或者值为 0（相同的字母在另一个位置被正确使用），我们可以将其标记为 `'ABSENT'`。
3. 最后，如果所有猜测都被用完而没有找到正确的单词，游戏结束并显示正确的单词。否则，光标移动到下一行。

#### `resetGame`

当被调用时，此函数将游戏状态重置为其初始值。它设置了当天的单词、重置字母网格、光标位置、游戏状态和字母猜测状态。

### 状态

该代码使用几个状态变量来管理游戏状态和用户交互。以下是每个状态变量及其用途的说明：

* `wordOfTheDay`：此状态变量存储玩家需要猜测的随机选择的单词。它使用预定义的列表 `WORDS` 中的一个随机单词进行初始化。它用于比较玩家的猜测并确定他们是否正确猜出了单词。
* `gameState`：此状态变量表示游戏的总状态。它可能有三种可能的值：
  * `GAME_STATE.IN_PROGRESS`：游戏仍在进行中，玩家可以继续猜测。
  * `GAME_STATE.GUESSED_CORRECTLY`：玩家在允许的尝试次数内正确猜出了单词。
  * `GAME_STATE.NO_MORE_GUESSES`：玩家在没有正确猜出单词的情况下用完了所有尝试。
* `gridState`：此状态变量是一个二维数组，表示网格的状态，其中每个单元格代表单词中的一个字母。它存储一个具有两个属性的对象：`char`（字母）和 `state`（字母猜测的状态）。`gridState` 使用 `getInitialGridState` 函数进行初始化。
* `position`：此状态变量表示光标在网格中的当前位置。它是一个包含行和列索引的 2 元素数组。初始位置设置为 `INITIAL_CURSOR_POSITION`，即 `[0, -1]`（在第一个单元格之前）。
* `letterGuessState`：此状态变量是一个对象，用于跟踪玩家所做的每个字母猜测的状态。对象的键是猜测的字母，值是相应的猜测状态 (`LETTER_GUESS_STATE`)。`getInitialLetterGuessState` 函数对其进行初始化。虚拟键盘使用此值来确定要渲染键的颜色。

### 渲染

该解决方案大量使用 CSS 变量来使用相关的状态颜色渲染猜测中的字母和虚拟键盘。由于颜色值在 UI 的多个部分中使用，因此使用 CSS 变量。

### 模型

我们将所有模型存储在 `models.ts` 文件中，并提出了关于字母猜测状态、游戏状态和网格状态的想法，这些想法与 `LetterGuessState` 结合在一起。

```typescript
export interface GridState {
  char: string;
  state: LetterGuessState;
}
```

```typescript
export enum LetterGuessState {
  INDETERMINATE = 'INDETERMINATE',
  ABSENT = 'ABSENT',
  PRESENT = 'PRESENT',
  CORRECT = 'CORRECT',
}
```

```typescript
export enum GameState {
  IN_PROGRESS = 'IN_PROGRESS',
  GUESSED_CORRECTLY = 'GUESSED_CORRECTLY',
  NO_MORE_GUESSES = 'NO_MORE_GUESSES',
}
```

### Angular 见解

* 您可以使用更高级的、类似反应式的方法，使用 RxJS（尽可能不使用订阅）。但是，如果您选择订阅，请记住销毁它们以防止内存泄漏。

* 您可以创建用于维护状态的服务。在智能组件中注入服务，并创建仅显示和与 UI 交互的哑组件，并且哑组件的所有事件都传递给智能组件。

* 如果您对最新的 Angular 版本有信心，请考虑使用信号独立 API。

* 您可以尝试更多地关注诸如 `readonly`、`private`、`public` 和 `void` 等关键字。

* 如果您正在创建一个更大的应用程序，最好为每个组件使用样式，而不是将所有样式放在一个文件中。

<TestCases />

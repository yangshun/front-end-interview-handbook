import TestCases from '../../../test-cases.mdx';
import Notes from '../../../notes.mdx';

## 解决方案

### Props

图中所示的默认打地鼠游戏是 3 x 3，预定义了回合和地鼠出现的时间。为了使游戏可定制，我们可以引入以下 props：

* `rows`：行数。
* `cols`：列数。
* `roundDuration`：回合持续时间。
* `molesAtOnce`：一次出现的地鼠数量。在街机游戏中，可以同时出现多个地鼠以增加难度。
* `molesAppearingInterval`：地鼠出现的时间间隔。

### State

游戏板可以表示为一维索引数组。在 3 x 3 的棋盘上，数组的长度为 9，索引 3 将对应于第 2 行第 1 列。

* `visible`：一组确定可见地鼠位置的索引。这是每隔 `molesAppearingInterval` 生成的。
* `score`：当前分数。
* `running`：游戏是否正在进行中。
* `timeLeft`：当前回合的剩余时间，以秒为单位。

### 渲染

CSS 网格用于以二维格式渲染单元格。这是一个不错的选择，因为您可以将单元格渲染为单个 DOM 元素列表，但使用正确的 CSS 网格设置，它们可以显示在 `rows` x `cols` 布局中。

### 生成地鼠

每隔 `molesAppearingInterval`，无论页面上可见的地鼠数量有多少，我们都应该为下一组 `molesAtOnce` 地鼠生成位置。我们可以随机生成 `molesAtOnce` 次索引，但是当 `molesAtOnce` > 1 时，生成的索引重复的几率很小，您需要再次随机生成。

生成唯一索引的一种优雅方法是创建一个索引数组，对数组进行洗牌，并获取前 `molesAtOnce` 个值。它需要 O(N) 空间，但这种方法更容易理解和正确实现。

在 React 组件中使用 `setInterval` 时，一个非常常见的错误来源是访问过时的 prop/state 值。因此，依赖变量用于 `useEffect` 依赖项数组中，以便在更新依赖变量时重新运行间隔。阅读 [Dan Abramov 的这篇文章](https://overreacted.io/making-setinterval-declarative-with-react-hooks/) 了解更多信息。

### `startGame`

此函数在新的回合开始时被调用，并启动一个倒计时计时器。它启动一个每秒运行的间隔计时器，每秒将 `currTimeLeft` 减少 1，直到 `currTimeLeft` 达到 0。

请注意，计时器也应在卸载时清除，因此我们可以将 timerId 分配给 `countdownTimerId` ref，并在组件卸载时清除它。否则，即使组件不再在屏幕上，计时器也可能仍在运行并尝试更新组件状态。

### `whackMole`

当单击正确的单元格时，此函数从 `visible` 集合中删除索引（如果它们存在于该集合中），并将分数增加 1。

<TestCases />

<Notes />

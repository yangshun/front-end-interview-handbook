## 解决方案

我们将在 [Data Table III 的解决方案](/questions/user-interface/data-table-iii/solution) 的基础上进行构建。

在 [Data Table III](/questions/user-interface/data-table-iii/solution) 中，`DataTable` 实现被泛化，不再包含任何特定于用户数据的代码。当使用过滤功能扩展组件时，我们需要保留这种泛化。

需要做几件事：

1. 在表头单元格中添加特定于列的过滤器输入 UI
2. 存储过滤器输入状态
3. 允许 `DataTable` 组件读取过滤器输入状态，并在过滤数据时使用它。过滤必须在排序和分页发生之前完成。

有几种方法可以设计要添加到列定义中的新字段以启用过滤：

1. 简单配置，但不够灵活
2. 需要更多配置，但更灵活
3. 提供默认配置，但也允许灵活性

### 1. 简单配置，但不够灵活

此方法涉及向列定义添加一个 `filterType` 字符串属性，该属性为 `string` 或 `range`。从外部 API 的角度来看，这就是所需的全部内容。复杂性将在于 `DataTable` 组件——它必须呈现各种过滤器输入，并在处理用于呈现的数据时使用它们。

1. 标题单元格通过迭代列定义来呈现。这里添加的内容是根据 `filterType` 值呈现适当的过滤器输入。
2. 当过滤器输入值更改时，将过滤器值作为状态存储在 `DataTable` 组件中，该组件位于名为 `filters` 的对象中。`filters` 对象的键是该列的唯一标识符（我们可以使用该列的 `key` 字段），值是与该列的过滤器输入关联的过滤器数据。每个过滤器类型都有其自己的格式：
   1. `string`：存储一个表示要过滤的字符串的单个值：`{ type: 'string'; value: string | null; }`
   2. `range`：存储两个数值，即范围的最大值和最小值：`{ type: 'range'; max?: number | null; min?: number | null; }`
3. 创建一个 `filterData` 函数，该函数接收数据和过滤器状态。对于数据的每一行，迭代 `filters` 对象，并且仅保留**通过所有过滤器检查**的行。

这种方法非常易于使用，因为 API 表面积很小，但请注意，更多代码被嵌入到 `DataTable` 中：

1. 我们根据 `filterType` 呈现相同的过滤器输入 UI；过滤器输入无法自定义。自定义有时很有用，例如，如果必须自定义占位符，或者使用您自己的输入 UI 组件。
2. 过滤逻辑也包含在 `DataTable` 中，对于字符串，它是区分大小写的子字符串匹配，对于数字，它是范围匹配。过滤逻辑无法自定义。

该解决方案使用这种方法，并且它可能足以用于面试。接下来，我们可以看看另一种更灵活的方法，但需要更多配置。

### 2. 需要更多配置，但更灵活

此方法涉及向包含过滤逻辑的列定义添加几个函数字段。`DataTable` 组件将在呈现过滤器输入和过滤匹配行时调用这些函数。过滤器值状态可以与方法 1 相同——`filters` 对象，其键为列 `key`，值为特定于列的过滤器数据。

1. `renderFilter(filterValue, setFilterValue)`：一个渲染过滤器输入的函数。它接收当前的 `filterValue` 和一个 `setFilterValue` 函数。该函数应返回显示 `filterValue` 的 UI，并通过调用 `setFilterValue` 响应用户输入，这将保留 `DataTable` 中该列的过滤器状态。
2. `matchesFilter(value, filterValue)`：一个确定值是否与过滤器匹配的函数。它接收该行中该列的值和 `filterValue`，开发人员可以自行实现其匹配逻辑。

使用这种方法，可以提供最大的灵活性——开发人员可以完全控制呈现和匹配逻辑。但是，如果对所有基于字符串的字段使用类似的匹配逻辑，则可能会有很多重复。这种方法类似于用于排序的 `comparator` 函数。

### 3. 默认配置，具有灵活性

混合解决方案是允许简单和高级配置选项。对于每一列，如果定义了 `renderFilter` 和/或 `matchesFilter` 字段，则调用它们进行呈现/过滤，否则使用与简单方法相同的默认值。

如果您有兴趣，请修改解决方案以使用这种混合方法。

## 后续

现在我们有了一个支持分页、排序和过滤的通用数据表。下一个合乎逻辑的扩展是从远程 API 获取数据。

从远程 API 获取数据时，服务器将负责进行分页、排序、过滤，因此 `DataTable` 组件不再需要包含这些处理逻辑。该组件唯一需要做的就是收集用户输入（当前页面、页面大小、排序字段、排序方向、过滤器状态），使用这些选项调用 API，然后呈现结果。

看看 [TanStack Table](https://tanstack.com/table/)，了解生产就绪的数据表库有哪些功能以及数据表可能有多复杂。

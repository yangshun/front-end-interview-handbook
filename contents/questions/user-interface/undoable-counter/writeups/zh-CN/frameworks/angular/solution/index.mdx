import TestCases from '../../../test-cases.mdx';
import Notes from '../../../notes.mdx';

## 解决方案

`AppComponent` 具有直接和清晰的结构 - 当我们从模板调用一个操作时，它会立即在我们的 `UndoableCounterService` 中被调用和处理。

`performOperation` 函数用于将操作应用于计数器值。它有两个参数：`counter` 和 `operationLabel`。`counter` 是计数器的当前值，`operationLabel` 是一个字符串，用于指定要执行的操作。

`OPERATIONS` 对象是一个字典，它将操作标签映射到描述该操作的对象。每个操作对象都有一个 type 属性，用于指定操作的类型（增加、减少、乘法或除法），以及一个 number 属性，用于指定操作数。

`performOperation` 函数从 `OPERATIONS` 对象中查找指定操作标签的操作对象。例如，如果 operationLabel 是 `'+1'`，performOperation 将从 `OPERATIONS` 对象中查找对象 `{ type: 'increment', number: 1 }`，并将 1 加到计数器中。

`onUndo` - 当单击“撤消”按钮时调用此函数。它负责撤消上次执行的操作，并相应地更新计数器和历史记录。

更具体地说，`onUndo` 从历史记录数组中删除第一项，并将计数器值设置为已删除项的旧计数器值。然后将删除的项添加到 undoHistory 数组中，该数组存储已撤消操作的列表。

`onRedo` - 此函数用于重做 onUndo 函数撤消的最后一个操作。

当调用 `onRedo` 时，它从 undoHistory 状态检索最近撤消的操作，并将计数器设置为该操作的 `newCounter` 值。然后，它从 undoHistory 状态中删除撤消的操作，并将其添加回历史记录状态，从而有效地重新应用该操作。

`onReset` - 此函数将所有内容重置回初始状态。

### 状态

在我们的 `UndoableCounterService` 中，我们有以下状态：

* `counter`：计数器的当前值。
* `history`：一个包含操作历史记录的数组。操作列表按逆时间顺序排列。
* `undoHistory`：一个包含已撤消操作历史记录的数组。操作列表按逆时间顺序排列。

### 渲染

在模板中，我们有以下 HTML 结构：

* 操作按钮（撤消、重做、重置）
* 带有当前值的数学按钮
* 操作历史记录（从 `service` 显示 `history`）

### 模型

用于 `OPERATIONS` 中使用的操作的类型。

```typescript
export interface Operation {
  type: string;
  number: number;
}
```

用于 `history` 和 `undoHistory` 的类型。

```typescript
export interface History {
  operation: string;
  oldCounter: number;
  newCounter: number;
}
```

### Angular 见解

* 您可以使用 RxJS 采用更高级的、类似反应式的方法（无需使用订阅）。但是，如果您选择订阅，请记住销毁它们以防止内存泄漏。

* 如果您对最新的 Angular 版本有信心，请考虑使用信号独立 API。

* 您可以尝试更多地关注诸如 `readonly`、`private`、`public` 和 `void` 等关键字。

* 如果您正在创建一个更大的应用程序，最好为每个组件使用样式，而不是将所有样式放在一个文件中。

<TestCases />

<Notes />

import TestCases from '../../../test-cases.mdx';
import Notes from '../../../notes.mdx';

## 解决方案

### 属性和响应式语句

在这个 Svelte 代码中，我们模拟了交通灯的行为。我们有一些属性（有时称为“props”）：

* `initialColor`：这是交通灯的初始颜色。其默认值设置为 `green`。
* `config`：一个为每个交通灯颜色提供配置的对象。这包括颜色应该显示的持续时间和应该显示的下一个颜色。
* `layout`：确定交通灯的布局方向，`vertical` 或 `horizontal`。 默认情况下，它设置为 `vertical`。

此外，还有一个响应式语句 `$: setTimer(currentColor);`，它监视 `currentColor` 变量。 只要 `currentColor` 发生变化，就会调用 `setTimer` 函数。

### 计时器管理

代码中的主要逻辑围绕着计时机制：

* `setTimer`：此函数将颜色作为其参数。它从 `config` 对象中查找给定颜色的持续时间，并为该持续时间设置一个计时器 (`setTimeout`)。当计时器到期时，`currentColor` 将更新为 `config` 中指定的下一个颜色。

* `onDestroy`：此生命周期函数确保当组件被销毁（或从 DOM 中删除）时，任何正在进行的计时器都会使用 `clearTimeout(timerId);` 清除。这对于防止意外行为或内存泄漏非常重要。

### 渲染

关键的渲染功能包括：

* ARIA 可访问性：交通灯容器具有 `aria-live="polite"`，这向屏幕阅读器表明它们应该通知用户更改，但不要中断当前任务。 这样，使用辅助技术的用户将了解交通灯的当前状态。

* 动态类：基于 `layout` 属性，类 `traffic-light-container--vertical` 有条件地应用于容器以调整交通灯的方向（垂直或水平）。

* 颜色迭代：使用 `{#each ... as color}` 块，代码遍历 `config` 对象中的每种颜色。 对于每种颜色，都会创建一个带有类 `traffic-light` 的 `div`。 如果颜色与 `currentColor` 匹配，它将获得适当的背景颜色。 如果没有，它将默认为暗淡的灯光。

* 样式：CSS 定义了交通灯容器和各个灯的外观。 值得注意的是，它使用 CSS 变量（例如 `var(--size)`）来定义尺寸，这在需要调整大小时提供了灵活性。

### 结论

Svelte 组件模拟了一个交通灯，其行为可根据提供的配置进行自定义。 Svelte 的响应式特性用于管理计时器并无缝切换灯光颜色，同时也确保在不再需要资源时正确清理它们。 在渲染方面，该组件采用了 Svelte 的循环机制、条件样式和可访问性功能，以提供视觉上吸引人且用户友好的体验。

<TestCases />

<Notes />

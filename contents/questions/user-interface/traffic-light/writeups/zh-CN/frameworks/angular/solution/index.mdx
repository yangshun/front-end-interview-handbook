import TestCases from '../../../test-cases.mdx';
import Notes from '../../../notes.mdx';

## 解决方案

在 `AppComponent` 中，我们使用常用的 TypeScript `Record` 类型 `Record<Colors, ColorConfig<Colors>>` 定义颜色配置，并将该配置传递给 `TrafficLightComponent`。

在 `TrafficLightComponent` 中，在 `OnInit` 钩子期间，我们将 `currentColor` 设置为传递的颜色并调用 `updateLight` 方法。在更新期间，我们以递归方式永久运行 `setTimeout`。进入该方法后，我们解构配置对象并分配 `duration` 和 `next` 变量。然后，我们使用提供的 `duration` 执行 `setTimeout`，并将配置中的 `next` 颜色分配为当前颜色。之后，我们再次运行 `updateLight()` 方法。

### 渲染

此组件的渲染非常简单，可以使用 Flexbox 实现。使用 Flexbox，只需更改 `flex-direction` 属性，就可以轻松地将灯的布局从垂直布局更改为水平布局。

### 模型

```typescript
type Layout = 'vertical' | 'horizontal';
```

```typescript
type DefaultColors = 'green' | 'yellow' | 'red';
```

注意：看看 `Colors` 在这里以及在 `next` 字段中的关系。

```typescript
type ColorConfig<Colors> = {
  backgroundColor: string;
  duration: number;
  order: number;
  next: Colors;
};
```

交通灯的主要配置类型，需要 `Record` 类型（类似于 JavaScript 中的 Map），其中键必须是 `Colors`，值是来自前一个类型的 `ColorConfig<Colors>`。

```typescript
export type TrafficLightConfig<
  Colors extends DefaultColors,
> = Record<Colors, ColorConfig<Colors>>;
```

### Angular 见解

* 您可以使用更高级的、类似反应式的方法，使用 RxJS（无需使用订阅）。但是，如果您选择订阅，请记住销毁它们以防止内存泄漏。

* 您可以创建用于维护状态的服务。在智能组件中注入服务，并创建仅显示和与 UI 交互的哑组件，并且哑组件的所有事件都传递给智能组件。

* 如果您对最新的 Angular 版本有信心，请考虑使用信号独立 API。

* 您可以尝试更多地关注诸如 `readonly`、`private`、`public` 和 `void` 等关键字。

* 如果您正在创建一个更大的应用程序，最好为每个组件使用样式，而不是将所有样式放在一个文件中。
  <TestCases />
  <Notes />

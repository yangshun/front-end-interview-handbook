import TestCases from '../../../test-cases.mdx';
import Notes from '../../../notes.mdx';

## 解决方案

这个问题的重点在于处理存在待处理请求时的各种状态。

每次点击时，我们都会运行 `likeUnlikeAction`，它会改变我们的状态：它将 `pending` 值设置为 `true`，表明它正在等待来自后续 HTTP 请求的响应。我们使用带有提供 url 的 `HttpClient` 服务来为我们的按钮（`unlike` 或 `like`）建立一个新值，我们将其包含在第二个参数中作为有效载荷。通过订阅此调用，我们将收到响应或错误。如果我们收到响应，我们会将 `isPending` 状态更改为 `false`，因为调用已完成，我们不再需要显示待处理动画。我们还将 `liked` 值设置为相反的值，因为在请求响应中我们只有“成功响应”。如果遇到错误，我们将 `isPending` 设置为 false，并从错误响应中分配错误消息。

### 状态

我们需要一些状态变量：

* `liked`：跟踪按钮是在默认状态还是点赞状态。由于只有两种状态，我们可以使用布尔类型来表示它。
* `isPending`：确定是否有待处理的后台请求。
* `errorMessage`：当 API 请求失败时从后端获取的错误消息。

### 渲染

渲染代码非常简单，因为在渲染 UI 时，状态变量之间没有太多依赖关系。不需要 Typescript 模型（接口）。

### Angular 见解

* 您可以使用更高级的、类似反应式的方法，使用 RxJS（无需使用订阅）。但是，如果您选择订阅，请记住销毁它们以防止内存泄漏。

* 您可以为 HTTP 请求创建服务，并为维护状态创建另一个服务。

* 如果您对最新的 Angular 版本有信心，请考虑使用信号独立 API。

* 您可以尝试更多地关注诸如 `readonly`、`private`、`public` 和 `void` 等关键字。

* 如果您正在创建一个更大的应用程序，最好为每个组件使用样式，而不是将所有样式放在一个文件中。

<TestCases />

<Notes />

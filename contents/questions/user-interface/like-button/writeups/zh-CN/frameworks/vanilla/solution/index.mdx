import TestCases from '../../../test-cases.mdx';
import Notes from '../../../notes.mdx';

## 解决方案

此问题的重点在于处理存在待处理请求时的各种状态。

### 初始化

为了使 `likeButton` 函数组件化，该函数接受两个元素，即按钮元素和错误消息元素。如果页面上有多个 Like 按钮，开发人员需要确保将 DOM 元素的单独实例传递给该函数。

### 数据模型

我们需要几个状态变量：

* `liked`: 跟踪按钮处于默认状态还是已点赞状态。由于只有两种状态，我们可以使用布尔类型来表示它。
* `isPending`: 确定是否有待处理的后台请求。
* `errorMessage`: 从后端获取的 API 请求失败时的错误消息。

### 制作后端 API 请求

编写制作后端请求的代码非常标准，通常您应该使用以下流程：

1. 将 UI 设置为显示加载状态。
2. 清除错误消息。
3. 通过 `fetch` 发出后端请求
4. 确定请求是否成功。
   1. 如果响应成功，则更新 UI 以指示成功。
   2. 如果响应失败，则通过显示错误消息来更新 UI 以指示失败。
5. 删除加载状态。

以上内容在 `likeUnlikeAction` 函数中捕获。

### 渲染

在按钮内，有两个经常更改的元素，即图标和标签。因此，我们可以创建两个内部 `span` 来包含这些元素。

我们定义了两个用于渲染的函数：

* `init`: 渲染不变化的类名和元素。顾名思义，此函数仅在初始时调用一次。
* `update`: 更新 UI 以反映最新状态。每当需要更新 UI 时，都会调用此函数。

<TestCases />

<Notes />
